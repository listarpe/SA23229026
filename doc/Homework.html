<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="By SA23229026" />


<title>Homework-2023.11.13</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework-2023.11.13</h1>
<h4 class="author">By SA23229026</h4>
<h4 class="date">2023/11/13</h4>



<div id="section" class="section level1">
<h1>2023/09/11</h1>
<div id="question" class="section level2">
<h2>Question</h2>
<p>使用Knitr生成三个例子，每个例子需要包含文本以及图片或表格，附带一些公式。</p>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<div id="example-1" class="section level3">
<h3>Example 1</h3>
<p>鸢尾花数据集是分类方法文献中最早使用的数据集之一，并广泛用于统计和机器学习。该数据集包含3个类，每个类有50个实例，每个类代表一种鸢尾花。下面查看一下鸢尾花数据集的详细信息：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> iris</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
<pre><code>##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## </code></pre>
<p>下面以长度为横坐标、长度为纵坐标，不同种类用不同的颜色画一幅散点图：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># par(pin=c(3,2))</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">plot</span>(data<span class="sc">$</span>Sepal.Length, data<span class="sc">$</span>Sepal.Width, <span class="at">col=</span>data<span class="sc">$</span>Species, <span class="at">xlab =</span> <span class="st">&quot;Sepal Length(cm)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Sepal Width(cm)&quot;</span>, <span class="at">main=</span><span class="st">&quot;Three Classes of Iris&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>图中每个空心圆点表示一个样本，一共有黑色、红色、绿色三个种类的样本，横坐标表示花瓣长度，纵坐标表示花瓣宽度。</p>
</div>
<div id="example-2" class="section level3">
<h3>Example 2</h3>
<p>线性回归是一种通过线性模型来拟合样本的属性与标记的方法。对于数据集<span class="math inline">\(D =
\{(x_1,y_1),(x_2,y_2),\ldots,(x_n,y_n)\}\)</span>，线性回归希望得到</p>
<p><span class="math display">\[
f(x_i) = wx_i+b,其中f(x_i) \simeq y_i.
\]</span></p>
<p>确定<span class="math inline">\(w\)</span>和<span class="math inline">\(b\)</span>的方式就是最小化如下的损失函数</p>
<p><span class="math display">\[
L(w,b)= \sum_{i=1}^n(f(x_i)-y_i)^2
\]</span> 下面对一组身高体重数据集进行回归</p>
<table>
<thead>
<tr class="header">
<th align="center">Height</th>
<th align="center">Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">151</td>
<td align="center">63</td>
</tr>
<tr class="even">
<td align="center">174</td>
<td align="center">81</td>
</tr>
<tr class="odd">
<td align="center">138</td>
<td align="center">56</td>
</tr>
<tr class="even">
<td align="center">186</td>
<td align="center">91</td>
</tr>
<tr class="odd">
<td align="center">128</td>
<td align="center">47</td>
</tr>
<tr class="even">
<td align="center">136</td>
<td align="center">57</td>
</tr>
<tr class="odd">
<td align="center">179</td>
<td align="center">76</td>
</tr>
<tr class="even">
<td align="center">163</td>
<td align="center">72</td>
</tr>
<tr class="odd">
<td align="center">152</td>
<td align="center">62</td>
</tr>
<tr class="even">
<td align="center">131</td>
<td align="center">48</td>
</tr>
</tbody>
</table>
<p>最终得到的线性回归模型如图所示</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="example-3" class="section level3">
<h3>Example 3</h3>
<p>K-means是一种常用的聚类算法，它的算法步骤为：</p>
<ol style="list-style-type: decimal">
<li>初始化：选择初始化的k个样本作为初始的中心；</li>
<li>迭代：</li>
</ol>
<ul>
<li>对于每个样本，计算它到k个中心的距离，并把它划分到距离最小的中心所对应的类中；</li>
<li>对于每个类，重新计算中心。</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>当每个样本所属的类不再发生改变时定制迭代。</li>
</ol>
<p>下面随机生成100个样本：</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>聚类结果如下</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
</div>
<div id="section-1" class="section level1">
<h1>2023/09/18</h1>
<div id="question-1" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li><p>使用逆变换方法实现函数<code>sample()</code>的部分功能，其中参数<code>replace=TRUE</code>。</p></li>
<li><p>标准Laplace分布的密度函数为<span class="math inline">\(f(s) =
\frac{1}{2}e^{-\vert x \vert}\)</span>，<span class="math inline">\(x\in
\mathbb{R}\)</span>。使用逆变换生成1000次这个分布的采样，并将生成的采样和目标分布进行比较。</p></li>
<li><p>使用acceptance-rejection method写一个函数，从<span class="math inline">\(Beta(a, b)\)</span>分布中随机采样n次。举例从<span class="math inline">\(Beta(3, 2)\)</span>中随机采样1000次。画出采样的
直方图，并在上面加上<span class="math inline">\(Beta(3,2)\)</span>的概率密度函数。</p></li>
<li><p>生成密度函数 <span class="math display">\[
f_e(x) = \frac{3}{4}(1-x^2), \quad \vert x \vert \le1.
\]</span> 使用如下算法：生成iid的<span class="math inline">\(U_1,U_2,U_3~U(-1, 1)\)</span>。如果<span class="math inline">\(\vert U_3 \vert \geq \vert U_2
\vert\)</span>并且<span class="math inline">\(\vert U_3 \vert \geq \vert
U_1 \vert\)</span>，则取<span class="math inline">\(\vert U_2
\vert\)</span>；否则取<span class="math inline">\(\vert U_3
\vert\)</span>。写一个函数生成<span class="math inline">\(f_e\)</span>的随机变量，并画直方图。</p></li>
<li><p>证明上一问中的算法。</p></li>
</ol>
</div>
<div id="answer-1" class="section level2">
<h2>Answer</h2>
<div id="逆变换复现sample" class="section level3">
<h3>1 逆变换复现<code>sample()</code></h3>
<p><strong>Usage</strong></p>
<p><code>Mysample(x, size, prob=Null)</code></p>
<p><strong>Description</strong></p>
<p><code>Mysample</code>从区间<code>x</code>中有放回地采样个数为<code>size</code>的样本。</p>
<p><code>x</code>：采样区间；</p>
<p><code>size</code>：采样个数。</p>
<p><code>prob</code>：概率，默认等概率，可以输入想要的概率。</p>
<p>函数定义如下</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Mysample <span class="ot">&lt;-</span> <span class="cf">function</span>(x, size, <span class="at">prob=</span><span class="cn">NULL</span>){</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x) <span class="co"># 获取区间x中的元素个数</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(prob)) {</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>n, n) <span class="co"># 如果prob为空，所有样本概率相同</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  }</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  cp <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(prob)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">runif</span>(size)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  r <span class="ot">&lt;-</span> x[<span class="fu">findInterval</span>(U, cp)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">return</span>(r)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Examples</strong></p>
<p>从{0，1}中采样10次</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">Mysample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>从{2,5,8,9}中采样1000次</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">Mysample</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>), <span class="dv">1000</span>, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">3</span>, .<span class="dv">4</span>, .<span class="dv">1</span>))</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(r))</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAUVBMVEUAAAAAADoAAGYAOjoAOpAAZrY6AAA6ADo6AGY6Ojo6kNtmAABmADpmtv+QOgCQ2/+2ZgC2/7a2//++vr7bkDrb////tmb/25D//7b//9v////WvTaMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEs0lEQVR4nO3d61LaUBRA4dgqvVAxbSO393/QBgLaaUnWPmNCLmetX870zBa+CSexEC2O1lkx9gOYegJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQWlAh01x7tOvgR7O9EoCqorvzRfb6xfLLwXosHljqR5fB3gwUywFaL9+vn65zeZF5hEEJe5Bl0PIPail/bo5i2Vz/MzmOqjghvrOA83tueI3NQ2g0S4UZwI03oXiPIBGPM3PA6j9QnH4rXIWQIEjKG+gwIVi5kB8oZg70L3Hvc8VCObOCmi3em77p7yBrjtQx7V03kDXk5dHUGv79en8JVBH5cOLQJ3VP7AK1Nlu9Vmgzg6bQqCJjHufKxDMFQjmCgRzBYK5AsFcgWCuQDBXIJgrEMwVCOYKBHNnDuQ7qwONC3/sJ1ug6PMWSKDbywWC5QLBcoFguUCwXCBYLhAsFwiWCwTLBYLlAsHypQHhvRqZA/G9GnkD9f9J+4UBBW7qzRvII4jq/V6NpQH1fq/G4oD6HicQLV8akBeK3UUvFPt/u2seQOHTfP/Pex5A4Zt6cwXyCKKiF4rZAkUvFPMFCo4TCMblC1TVL6/zNlR1/ndHtkDVw0u9DT0dBbpdc5o/bOotWqBbXS8Uy8dXgW71dqFYPgl0sytLfTkk0M2ul9KHjUAfGScQjBMIxgkE4wSCcQLBOIFgnEAwTiAYJxCMEwjGCQTjBIJxAv03xXdWk8YJBOMEgnECwTiBYNyIQOHPbqU9o94aHyi6MO0Z9ZZAoXECwTiBYJxAME4gGCcQjBMIxgkE4wSCcQLBOIFgnEAwTiAYJxCMEwjG5QsUvGc1W6DwPauZAs3hjsNRgeL3rIbveh5v4RBAI/4p4/FK3IPontXllXbA4T2ry6vn66DlJRAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkEDQ80Pn9/Mi7RM1bJk+BlW+/rTCw8OElsrC9wYEOm/ohVpHnvfsSfC6n31a4jQiV9cLdKkTZ2uBAzQNs+6Vwf9f2tzr+7bA5aZdMvl+fDtwPvgl8pz1oGzjSq8ir65gA1HzTyLfu6E5AZeDoKL8FN6voS+wCFNuu2roPUOS9/P369FooI0Lb2N57eXXPAGgbOjc1SyOHWr1mtwpINpv09IFSPgsSOOnEt/1jWRSffv6Y+h5UpXxWJnCuT9x7d19jJ8eWhgeK7gHNgRF4iYUXXr7/xE/zoc3i3PnEHdmko3vQ+Vdff/AsPzxQ1XzkKvIwy+hPEGXCDy+T/1Fj7gkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQT9AeKwfJuvCbCuAAAAAElFTkSuQmCC" /><!-- --></p>
</div>
<div id="标准laplace分布" class="section level3">
<h3>2 标准Laplace分布</h3>
<p>标准Laplace分布的概率密度函数<span class="math inline">\(f(x) =
\frac{1}{2}e^{-\vert x \vert}\)</span>，可以得到其分布函数为</p>
<p><span class="math display">\[
F_X(x) =
\begin{cases}
  \frac{1}{2}e^x &amp; \text{if } x \leq 0 \\
  1-\frac{1}{2}e^{-x} &amp; \text{if } x &gt; 0
\end{cases}
\]</span> 求其逆函数可以得到</p>
<p><span class="math display">\[
F_X^{-1}(u) =
\begin{cases}
  \log{2u} &amp; \text{if } u \leq \frac{1}{2} \\
  -\log{2(1-u)} &amp; \text{if } u &gt; \frac{1}{2}
\end{cases}
\]</span></p>
<p>这个分段函数可以用一个符号函数<span class="math inline">\(sign()\)</span>合并</p>
<p><span class="math display">\[
F_X^{-1}(u) = sign(\frac{1}{2}-u)log(1-\vert 2u-1 \vert)
\]</span></p>
<p>编程实现如下，并用直方图和原分布做比较</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>r <span class="ot">=</span> <span class="fu">sign</span>(<span class="fl">0.5</span><span class="sc">-</span>u)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">abs</span>(<span class="dv">2</span><span class="sc">*</span>u<span class="dv">-1</span>))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">hist</span>(r, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.55</span>), <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">f</span>(x)<span class="sc">==</span><span class="fu">frac</span>(<span class="dv">1</span>,<span class="dv">2</span>)<span class="sc">*</span>e<span class="sc">^-</span><span class="fu">abs</span>(x)))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, .<span class="dv">01</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">lines</span>(y, <span class="fl">0.5</span><span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(y)))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="beta分布" class="section level3">
<h3>3 Beta分布</h3>
<p><span class="math inline">\(Beta(a,
b)\)</span>分布的概率密度函数为<span class="math inline">\(f(x; a, b) =
\frac{x^{a - 1} (1 - x)^{b - 1}}{B(a, b)}\)</span>。另<span class="math inline">\(g(x)～U(0,1)\)</span>。可以直接另<span class="math inline">\(c=\frac{1}{B(a,b)}\)</span>，但这不是<span class="math inline">\(c\)</span>的最小取值，为找到<span class="math inline">\(c\)</span>的最小取值，可以通过求<span class="math inline">\(f (x;a,b)\)</span>的最大值得到。由于<span class="math inline">\(f(x;a,b)\)</span>在<span class="math inline">\((0,1)\)</span>上只有一个极值点，且是极大值点，所以直接求其极值点即可。</p>
<p><span class="math display">\[
\frac{df}{dx}=\frac{1}{B(a,b)}[(a-1)x^{a-2}(1-x)^{b-1}-(b-1)x^{a-1}(1-x)^{b-2}]=0
\\
x = \frac{a-1}{a+b-2}
\]</span> 所以当<span class="math inline">\(x=
\frac{a-1}{a+b-2}\)</span>时，可以得到最大值<span class="math inline">\(f_{max}(x;a,b)=\frac{1}{B(a,b)}(\frac{a-1}{a+b-2})^{a-1}(1-\frac{a-1}{a+b-2})^{b-1}\)</span>，另<span class="math inline">\(c=f_{max}(x;a,b)\)</span>可以使计算效率最高。</p>
<p>下面给出用acceptance-rejection method进行Beta分布采样的函数</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>myBeta <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, n){</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  t <span class="ot">=</span> (a<span class="dv">-1</span>)<span class="sc">/</span>(a<span class="sc">+</span>b<span class="dv">-2</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  c <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a, b)<span class="sc">*</span>t<span class="sc">**</span>(a<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>t)<span class="sc">**</span>(b<span class="dv">-1</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  j <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="cf">while</span>(k<span class="sc">&lt;</span>n){</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    j <span class="ot">&lt;-</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">dbeta</span>(u2, a, b) <span class="sc">&gt;</span> u1){</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>      y[k] <span class="ot">&lt;-</span> u2</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    }</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  }</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">j =</span> j, <span class="at">c =</span> c)</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>}</span></code></pre></div>
<p>下面对<span class="math inline">\(Beta(3,2)\)</span>进行1000次采样，并绘制直方图</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">myBeta</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1000</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;iterations: &quot;</span>, out<span class="sc">$</span>j)</span></code></pre></div>
<pre><code>## iterations:  1353</code></pre>
<p>采样1000个变量总共只迭代了这么多次，效率很高。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> out<span class="sc">$</span>y</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, out<span class="sc">$</span>c), <span class="at">main=</span><span class="st">&quot;Beta(2,3)&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">001</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">lines</span>(y, <span class="fu">dbeta</span>(y, <span class="dv">3</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="f_e" class="section level3">
<h3>3 <span class="math inline">\(f_e\)</span></h3>
<p>算法编程如下</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>myfe <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="cf">while</span>(k<span class="sc">&lt;</span>n){</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    u3 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">abs</span>(u3)<span class="sc">&gt;</span><span class="fu">abs</span>(u2) <span class="sc">||</span> <span class="fu">abs</span>(u3)<span class="sc">==</span> <span class="fu">abs</span>(u2)) <span class="sc">&amp;&amp;</span> (<span class="fu">abs</span>(u3)<span class="sc">&gt;</span><span class="fu">abs</span>(u1) <span class="sc">||</span> <span class="fu">abs</span>(u3)<span class="sc">==</span> <span class="fu">abs</span>(u1))){</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>      y[k] <span class="ot">&lt;-</span> u2</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>      y[k] <span class="ot">&lt;-</span> u3</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    }</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  }</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>}</span></code></pre></div>
<p>采样100000次，结果的直方图和原密度函数比较如下</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">myfe</span>(<span class="fl">1e5</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">hist</span>(y, <span class="at">prob =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="fu">expression</span>(f[e](x)<span class="sc">==</span><span class="fu">frac</span>(<span class="dv">3</span>,<span class="dv">4</span>)(<span class="dv">1</span><span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>x<span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">01</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fl">0.75</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x<span class="sc">**</span><span class="dv">2</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="证明算法" class="section level3">
<h3>5 证明算法</h3>
<p>要证明该算法，只需证明该算法得到的概率分布函数和原概率分布函数相同即可。</p>
<p>原概率分布函数为</p>
<p><span class="math display">\[
F_X(x)=\int_{-1}^{x}\frac{3}{4}(1-x^2)dx=-\frac{1}{4}x^3+\frac{3}{4}x+\frac{1}{2}
\]</span>
下面计算由该算法得到分布函数，由算法可以得到，分布函数可以分为两部分
<span class="math display">\[
\begin{align}
   F_U(x)&amp;=P(U\leq x)\\
   &amp;=P(U_2\leq x|U=U_2)P(U=U_2)+P(U_3\leq x|U=U_3)P(U=U_3)\\
   &amp;=P(U_2\leq x,U=U_2)+P(U_3\leq x,U=U_3)
\end{align}
\]</span> 记<span class="math inline">\(F_1(x) =P(U_2\leq
x,U=U_2),F_2(x)= P(U_3\leq x,U=U_3)\)</span>，分别进行计算。由于<span class="math inline">\(U_1, U_2,U_3\)</span>是iid的，所以可以得到 <span class="math display">\[
f(u_1, u_2, u_3) =f(u_1)f(u_2)f(u_3)
\]</span></p>
<p>首先计算<span class="math inline">\(-1\leq x
&lt;0\)</span>时的情况</p>
<p><span class="math display">\[
\begin{align}
  F_1(x) &amp;= \int_{-1}^{x}\int_{u_3}^{x}\int_{u_3}^{-u_3}
f(u_1)f(u_2)f(u_3)du_1du_2du_3
  +\int_{-x}^{1}\int_{-u_3}^{x}\int_{-u_3}^{u_3}
f(u_1)f(u_2)f(u_3)du_1du_2du_3\\
  &amp;=-\frac{1}{12}x^3+\frac{1}{4}x+\frac{1}{6}
\end{align}
\]</span> <span class="math display">\[
\begin{align}
F_2(x)&amp;=
4[\int_{-1}^{x}\int_{-1}^{u_3}f(u_1)f(u_3)du_1du_3]-4[\int_{-1}^{x}\int_{-1}^{u_3}\int_{-1}^{u_3}
f(u_1)f(u_2)f(u_3)du_1du_2du_3]\\
&amp;=-\frac{1}{6}x^3+\frac{1}{2}x+\frac{1}{3}
\end{align}
\]</span> 因此可以得到，当<span class="math inline">\(-1\leq x
&lt;0\)</span>时，有 <span class="math display">\[
F_U(x)=F_1(x)+F_2(x)=-\frac{1}{4}x^3+\frac{3}{4}x+\frac{1}{2}=F_X(x)
\]</span> 通过计算可以得到，<span class="math inline">\(0\leq x \leq
1\)</span>的情况与<span class="math inline">\(-1\leq x
&lt;0\)</span>是对称的，也有 <span class="math display">\[
F_U(x)=F_X(x)
\]</span> 得证。</p>
</div>
</div>
</div>
<div id="section-2" class="section level1">
<h1>2023/09/25</h1>
<div id="question-2" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li><p>证明当<span class="math inline">\(\rho
=\frac{l}{d}\)</span>取何值时，<span class="math inline">\(\hat{\pi}\)</span>的渐进方差最小? (<span class="math inline">\(m ∼ B(n,p)\)</span>, 使用<span class="math inline">\(\delta\)</span>法)</p></li>
<li><p>取三个不同的<span class="math inline">\(\rho\)</span>值(<span class="math inline">\(0 \leq \rho \leq 1\)</span>, 包含<span class="math inline">\(\rho_{min}\)</span>)然后使用Monte
Carlo模拟来验证你的答案。 (<span class="math inline">\(n =
10^6\)</span>, 重复模拟次数<span class="math inline">\(K =
100\)</span>)</p></li>
<li><p>在例子5.7中， 举了下面一个Monte Carlo积分的例子来说明control
variate逼近方法 <span class="math display">\[
\theta = \int_0^1 e^xdx.
\]</span> 现在考虑使用antithetic variate逼近。计算<span class="math inline">\(Cov(e^U,e^{1−U})\)</span>和<span class="math inline">\(Var(e^U + e^{1−U})\)</span>，其中<span class="math inline">\(U\)</span>∼Uniform(0,1)。使用antithetic
variate逼近可以让<span class="math inline">\(\hat{\theta}\)</span>的方差下降百分之多少（与简单的MC相比）？</p></li>
<li><p>联系上一问。使用Monte Carlo模拟来估计<span class="math inline">\(\theta\)</span>，分别通过antithetic
variate逼近和简单的Monte Carlo模拟方法。计算使用antithetic variate时，
方差减少百分比的经验估计。将结果与上一问中的理论值相比较。</p></li>
</ol>
</div>
<div id="answer-2" class="section level2">
<h2>Answer</h2>
<div id="section-3" class="section level3">
<h3>1</h3>
<p>证明. 首先，我们有概率<span class="math inline">\(p\)</span>的表达式</p>
<p><span class="math display">\[
p = \frac{2l}{\pi d}=\frac{2\rho}{\pi}.
\]</span></p>
<p>通过<span class="math inline">\(\hat{p} =
m/n\)</span>可以得到随机变量<span class="math inline">\(\hat{\pi}\)</span>与随机变量<span class="math inline">\(m\)</span>之间的关系为</p>
<p><span class="math display">\[
\hat{\pi} = \frac{2\rho}{\hat{p}}=\frac{2\rho n}{m}=f(m).
\]</span> 由于<span class="math inline">\(m\)</span>~<span class="math inline">\(B(n,p)\)</span>，我们可以得到</p>
<p><span class="math display">\[
\mu = E(m) = np,\\
\sigma^2= D(m) = np(1-p).
\]</span></p>
<p>根据<span class="math inline">\(\delta\)</span>法，可以得到<span class="math inline">\(\hat{\pi}\)</span>的近似方差为</p>
<p><span class="math display">\[
\begin{align}
D(\hat{\pi}) &amp; \approx [f&#39;(\mu)]^2\sigma^2\\
&amp;=\frac{4\rho^2n^2}{n^4p^4}np(1-p)\\
&amp;=\frac{4\rho^2(1-p)}{np^3},
\end{align}
\]</span></p>
<p>代入<span class="math inline">\(p = \frac{2l}{\pi
d}\)</span>可以得到</p>
<p><span class="math display">\[
D(\hat{\pi}) \approx \frac{\pi^3}{2n}(\frac{1}{\rho}-\frac{2}{\pi}).
\]</span></p>
<p>当<span class="math inline">\(0\leq \rho \leq
1\)</span>时，该式关于<span class="math inline">\(\rho\)</span>是递减的，所以<span class="math inline">\(\rho_{min}=1\)</span>时，<span class="math inline">\(\hat{\pi}\)</span>的渐进方差最小。</p>
</div>
<div id="section-4" class="section level3">
<h3>2</h3>
<p>分别取<span class="math inline">\(\rho = 0.5\)</span>，<span class="math inline">\(\rho = 0.8\)</span>和<span class="math inline">\(\rho = 1\)</span>，计算<span class="math inline">\(\hat{\pi}\)</span>的方差。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="co"># 试验次数</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 模拟次数</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>rhos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="dv">1</span>) <span class="co"># rho的取值</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="cf">for</span> (rho <span class="cf">in</span> rhos){</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(K, n, <span class="dv">2</span><span class="sc">*</span>rho<span class="sc">/</span>pi) <span class="co"># 以2*rho/pi的概率生成随机数</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  pi_hat <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>rho<span class="sc">*</span>n<span class="sc">/</span>m <span class="co"># 计算pi_hat</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  D <span class="ot">=</span> <span class="fu">var</span>(pi_hat) <span class="co"># 计算方差</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;rho =&quot;</span>, rho,<span class="st">&quot;    variance =&quot;</span>, D, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## rho = 0.5     variance = 2.237451e-05 
## rho = 0.8     variance = 1.080282e-05 
## rho = 1     variance = 4.421879e-06</code></pre>
<p>可以看到，当<span class="math inline">\(\rho =
1\)</span>时的方差时最小的。</p>
</div>
<div id="section-5" class="section level3">
<h3>3</h3>
<p>先计算<span class="math inline">\(Cov(e^U,e^{1-U})\)</span>，</p>
<p><span class="math display">\[
\begin{align}
  Cov(e^U,e^{1-U}) &amp;= E(e^Ue^{1-U})-E(e^U)E(e^{1-U}) \\
  &amp; = e - (e-1)^2 .
\end{align}
\]</span></p>
<p>下面计算<span class="math inline">\(Var(e^U+e^{1-U})\)</span>，</p>
<p><span class="math display">\[
Var(e^U) = E(e^{2U}) - [E(e^U)]^2 = \frac{e^2-1}{2}-(e-1)^2,
\]</span></p>
<p><span class="math display">\[
\begin{align}
  Var(e^{1-U}) &amp;= E(e^{2-2U}) - [E(e^{1-U})]^2\\
  &amp; = -\frac{1-e^2}{2}-(e-1)^2,
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{align}
Var(e^U+e^{1-U})&amp; = Var(e^U)+Var(e^{1-U})+Cov(e^U,e^{1-U}) \\
&amp; = \frac{e^2-1}{2}-(e-1)^2-\frac{1-e^2}{2}-(e-1)^2+2e -
2(e-1)^2  \\
&amp;= -3e^2+10e-5.
\end{align}
\]</span></p>
<p>下面来计算方差减少的百分比</p>
<p><span class="math display">\[
Var(\hat{\theta}) = \frac{1}{m}Var(e^U),\\
\hat{\theta}&#39; = \frac{1}{m}\sum_{j=1}^{m/2}(e^{U_j}+e^{1-U_j}),\\
Var(\hat{\theta}&#39;) = \frac{1}{2m}Var(e^U+e^{1-U}).
\]</span></p>
<p>所以</p>
<p><span class="math display">\[
1-\frac{Var(\hat{\theta}&#39;)}{Var(\hat{\theta})} =
1-\frac{\frac{1}{2}(-3e^2+10e-5)}{\frac{e^2-1}{2}-(e-1)^2} = 0.9676701,
\]</span></p>
<p>因此使用antithetic variate逼近可以让<span class="math inline">\(\hat{\theta}\)</span>的方差下降96.77%。</p>
</div>
<div id="section-6" class="section level3">
<h3>4</h3>
<p>分别通过antithetic variate逼近和简单的Monte Carlo模拟方法来估计<span class="math inline">\(\theta\)</span>，模拟<span class="math inline">\(10^6\)</span>次，每次采样100次。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="co"># 模拟次数</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span> <span class="co"># 采样次数</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>MC1 <span class="ot">=</span> <span class="fu">numeric</span>(K)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>MC2 <span class="ot">=</span> <span class="fu">numeric</span>(K)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  u <span class="ot">=</span> <span class="fu">runif</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">runif</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  MC1[i] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">exp</span>(<span class="fu">c</span>(u,v)))</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  MC2[i] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">exp</span>(<span class="fu">c</span>(u, <span class="dv">1</span><span class="sc">-</span>u)))</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>}</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>theta1 <span class="ot">=</span> <span class="fu">mean</span>(MC1)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>theta2 <span class="ot">=</span> <span class="fu">mean</span>(MC2)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>var1 <span class="ot">=</span> <span class="fu">var</span>(MC1)</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>var2 <span class="ot">=</span> <span class="fu">var</span>(MC2)</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;theta1:&quot;</span>,theta1,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">theta2:&quot;</span>,theta2,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">variance reduction:&quot;</span>, <span class="dv">1</span><span class="sc">-</span>var2<span class="sc">/</span>var1)</span></code></pre></div>
<pre><code>## theta1: 1.718265 
## theta2: 1.718293 
## variance reduction: 0.9676486</code></pre>
<p>两种方法模拟估计的<span class="math inline">\(\hat{\theta}\)</span>都和真实值接近，方差减少的百分比和上一问得到的理论值非常接近。</p>
</div>
</div>
</div>
<div id="section-7" class="section level1">
<h1>2023/10/09</h1>
<div id="question-3" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p><span class="math inline">\(Var(\hat{\theta}{}^M)=
\frac{1}{Mk}\sum_{i=1}^{k}\sigma_i^2+\frac{1}{M}Var(\theta_I)=Var(\hat{\theta}{}^S)+\frac{1}{M}Var(\theta_I)\)</span>,
where <span class="math inline">\(\theta_i = E[g(U)|I=i]\)</span>, <span class="math inline">\(\sigma_i^2 = Var[g(U)|I=i]\)</span> and <span class="math inline">\(I\)</span> takes uniform distribution over <span class="math inline">\({1,\ldots,k}\)</span>.</p>
<p>Proof that if <span class="math inline">\(g\)</span> is a continuous
function over <span class="math inline">\(a, b\)</span>, then <span class="math inline">\(Var(\hat{\theta}{}^S)/Var(\hat{\theta}{}^M) \to
0\)</span> as <span class="math inline">\(b_i-a_i \to 0\)</span> for all
<span class="math inline">\(i=1,\ldots,k\)</span>.</p>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<ul>
<li>Exercises 5.13, 5.14, 5.15 (pages 149-151, Statistical Computing
with R).</li>
<li>Exercises 6.5, 6.A (pages 180-181, Statistical Computing with
R).</li>
</ul>
</div>
<div id="answer-3" class="section level2">
<h2>Answer</h2>
<div id="section-8" class="section level3">
<h3>1</h3>
<p>证明.</p>
<p><span class="math display">\[
\begin{aligned}
\frac{Var(\hat{\theta}{}^S)}{Var(\hat{\theta}{}^M)} &amp; =
\frac{\frac{1}{Mk}\sum_{i=1}^{k}\sigma_i^2}{\frac{1}{Mk}\sum_{i=1}^{k}\sigma_i^2+\frac{1}{M}Var(\theta_I)}\\
&amp;=\frac{1}{1+
\frac{Var(\theta_I)}{\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2}},
\end{aligned}
\]</span> 当<span class="math inline">\(b_i-a_i \to 0\)</span>时，<span class="math inline">\(\theta_I \to g(U)\)</span>，则<span class="math inline">\(Var(\theta_i) \to Var(g(U))\)</span>。由于<span class="math inline">\(g\)</span>是连续的，可以得到<span class="math inline">\(Var(g(U))&lt;\infty\)</span>。下面再看分母<span class="math inline">\(\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2\)</span>,将其写成积分的形式</p>
<p><span class="math display">\[
\begin{aligned}
\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2 &amp;= \frac{1}{k}\sum_{i=1}^{k}
\int_{a_i}^{b_i}[g(u)-\theta_i]^2\frac{1}{b_i-a_i}du.
\end{aligned}
\]</span></p>
<p>我们令</p>
<p><span class="math display">\[
d_i = g_{max}(u)-g_{min}(u),\\
u \in [a_i, b_i],
\]</span></p>
<p>显然，<span class="math inline">\([g(u)-\theta_i]^2 \leq
d_i^2\)</span>，所以</p>
<p><span class="math display">\[
\begin{aligned}
\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2 &amp; &lt; \frac{1}{k}\sum_{i=1}^{k}
\int_{a_i}^{b_i}d_i^2\frac{1}{b_i-a_i}du\\
&amp; = \frac{1}{k}\sum_{i=1}^{k} (b_i-a_i)d_i^2\frac{1}{b_i-a_i}\\
&amp; =\frac{1}{k}\sum_{i=1}^{k}d_i^2,
\end{aligned}
\]</span></p>
<p>我们令</p>
<p><span class="math display">\[
d_{max} = \max_i{d_i}, \qquad
i  = 1, 2, \ldots, k,
\]</span> 可以得到</p>
<p><span class="math display">\[
\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2&lt;\frac{1}{k}\sum_{i=1}^{k}d_i^2&lt;\frac{1}{k}kd_{max}^2
= d_{max}^2
\]</span></p>
<p>由于<span class="math inline">\(g\)</span>是连续的，当<span class="math inline">\(b_i-a_i \to 0\)</span>时，<span class="math inline">\(d_{max}^2 \to 0\)</span>,即</p>
<p><span class="math display">\[
\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2 \to 0 \quad (b_i-a_i \to 0).
\]</span></p>
<p>综上，可以得到</p>
<p><span class="math display">\[
\frac{Var(\hat{\theta}{}^S)}{Var(\hat{\theta}{}^M)} =\frac{1}{1+
\frac{Var(\theta_I)}{\frac{1}{k}\sum_{i=1}^{k}\sigma_i^2}} \to 0 \quad
(b_i-a_i \to 0).
\]</span></p>
<p>得证。</p>
</div>
<div id="section-9" class="section level3">
<h3>5.13</h3>
<p>两个重要性函数分别为</p>
<p><span class="math display">\[
f_1(x) = \frac{1}{\sqrt{2\pi}}e^{-\frac{x^2}{2}},\\
f_2(x) = e^{-x}.
\]</span></p>
<p>使用Monte Carlo方法来估计方差</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> var.hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">2</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>}</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m) <span class="co"># f1</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">/</span> <span class="fu">dnorm</span>(x)</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>theta.hat[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>var.hat[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">var</span>(fg)</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(m, <span class="dv">1</span>) <span class="co"># f2</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">*</span> <span class="fu">exp</span>(x)</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>theta.hat[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>var.hat[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">var</span>(fg)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="fu">rbind</span>(theta.hat, var.hat)</span></code></pre></div>
<pre><code>##               [,1]      [,2]
## theta.hat 0.390903 0.4043807
## var.hat   1.252159 0.3456249</code></pre>
<p>通过Monte Carlo模拟，可以看到使用<span class="math inline">\(f_2\)</span>进行重要性采样的方差更小。</p>
</div>
<div id="section-10" class="section level3">
<h3>5.14</h3>
<p>使用如下函数来进行重要性采样</p>
<p><span class="math display">\[
f(x) = \frac{1}{\sqrt{2\pi}}e^{-\frac{(x-1.5)^2}{2}}
\]</span></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>}</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m, <span class="at">mean=</span><span class="fl">1.5</span>) <span class="co"># 设置正太分布的均值为1.5</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">/</span> <span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">1.5</span>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(fg)</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="fu">rbind</span>(theta.hat, se)</span></code></pre></div>
<pre><code>##                [,1]
## theta.hat 0.4024334
## se        0.3017844</code></pre>
<p>最终得到该积分的估计值<span class="math inline">\(\hat{\theta}\)</span>=0.4024334，估计标准差为0.3017844。</p>
</div>
<div id="section-11" class="section level3">
<h3>5.15</h3>
<p>在分层采样中，保持和Example5.10的总采样次数一致，都为1000次，估计的次数为50次，每次估计中将积分区间划分为5层。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># 总采样次数</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># 层数</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>E <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k) <span class="co"># 保存每次中每层的均值</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">50</span> <span class="co"># 估计次数</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>r <span class="ot">&lt;-</span> M<span class="sc">/</span>k<span class="sc">/</span>N</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>est <span class="ot">=</span> <span class="fu">numeric</span>(N) <span class="co"># 保存每次估计的均值</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>g<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span>(x<span class="sc">&lt;</span><span class="dv">1</span>)</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>}</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>    E[j]<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">g</span>(<span class="fu">runif</span>(r,(j<span class="dv">-1</span>)<span class="sc">/</span>k,j<span class="sc">/</span>k)))</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>  }</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>  est[i] <span class="ot">=</span> <span class="fu">mean</span>(E)</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>}</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>theta.hat <span class="ot">=</span> <span class="fu">mean</span>(est)</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>se <span class="ot">=</span> <span class="fu">sd</span>(est)</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="fu">rbind</span>(theta.hat, se)</span></code></pre></div>
<pre><code>##                  [,1]
## theta.hat 0.524700753
## se        0.003486331</code></pre>
<p>最终得到估计值<span class="math inline">\(\hat{\theta}\)</span>=0.5247008，估计标准差为0.0034863。而Example5.10中最小的估计标准差为0.097，分层采样很容易就得到了更小的标准差。</p>
</div>
<div id="section-12" class="section level3">
<h3>6.5</h3>
<p>令</p>
<p><span class="math display">\[
P(a\leq \frac{\sqrt{n}(\bar{X}-\mu)}{S}\leq b)=1-\alpha,\\
\frac{\sqrt{n}(\bar{X}-\mu)}{S}~t(n-1),
\]</span></p>
<p>可以得到均值<span class="math inline">\(\mu\)</span>的双侧<span class="math inline">\(1-\alpha\)</span>置信区间为</p>
<p><span class="math display">\[
[\bar{X}-t_{1-\frac{\alpha}{2}}\frac{S}{\sqrt{n}},\bar{X}+t_{1-\frac{\alpha}{2}}\frac{S}{\sqrt{n}}].
\]</span> 下面从分布<span class="math inline">\(\chi^2(2)\)</span>中随机采样，并用Monte
Carlo实验来估计t-置信区间的覆盖率。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> .<span class="dv">05</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>calcCI <span class="ot">&lt;-</span> <span class="cf">function</span>(n, alpha){</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, <span class="at">df =</span> <span class="dv">2</span>)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">mean</span>(y)<span class="sc">-</span><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>, <span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sd</span>(y)<span class="sc">/</span><span class="fu">sqrt</span>(n), <span class="fu">mean</span>(y)<span class="sc">+</span><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>, <span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sd</span>(y)<span class="sc">/</span><span class="fu">sqrt</span>(n)))</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>CL <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="at">expr =</span> <span class="fu">calcCI</span>(<span class="at">n=</span>n, <span class="at">alpha=</span>alpha))</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>rate <span class="ot">=</span> <span class="fu">mean</span>((CL[<span class="dv">1</span>,]<span class="sc">&lt;</span><span class="dv">2</span>)<span class="sc">*</span>(CL[<span class="dv">2</span>,]<span class="sc">&gt;</span><span class="dv">2</span>))</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="fu">print</span>(rate)</span></code></pre></div>
<pre><code>## [1] 0.926</code></pre>
<p>最终得到置信区间的覆盖率为92.6%。和Example6.4相比，在分布<span class="math inline">\(\chi^2(2)\)</span>中随机采样时，直接使用正态分布的置信区间，对均值的覆盖率会偏小。</p>
</div>
<div id="a" class="section level3">
<h3>6.A</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> .<span class="dv">05</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, m)</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, <span class="at">df=</span><span class="dv">1</span>) <span class="co"># X^2(1)</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu =</span> mu0)</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  p[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">2</span>) <span class="co"># U(0, 2)</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu =</span> mu0)</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>  p[<span class="dv">2</span>, ] <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>) <span class="co"># Exponential(1)</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu =</span> mu0)</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>  p[<span class="dv">3</span>, ] <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>}</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>p.hat <span class="ot">&lt;-</span> <span class="fu">apply</span>(p<span class="sc">&lt;</span>alpha, <span class="dv">1</span>, mean)</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>se.hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p.hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p.hat) <span class="sc">/</span> m)</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>table <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>  <span class="at">p.hat =</span> p.hat,</span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>  <span class="at">se.hat =</span> se.hat,</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>  <span class="at">row.names=</span><span class="fu">c</span>(<span class="st">&quot;X^2(1)&quot;</span>, <span class="st">&quot;U(0, 2)&quot;</span>, <span class="st">&quot;Exponential(1)&quot;</span>)</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>)</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a><span class="fu">print</span>(table)</span></code></pre></div>
<pre><code>##                p.hat se.hat
## X^2(1)             0      0
## U(0, 2)            0      0
## Exponential(1)     0      0</code></pre>
<p>总共进行了10000次双侧t检验，每次分别从3个分布中随机采样20个样本。在<span class="math inline">\(\alpha\)</span>=0.05的情况下，<span class="math inline">\(\chi^2(1)\)</span>，<span class="math inline">\(Uniform(0,2)\)</span>和<span class="math inline">\(Exponential(1)\)</span>全部接受原假设<span class="math inline">\(H_0\)</span>。<span class="math inline">\(\chi^2(1)\)</span>、<span class="math inline">\(Uniform(0,2)\)</span>和<span class="math inline">\(Exponential(1)\)</span>的经验<span class="math inline">\(T1e\)</span>比例为0%，标准差为0。</p>
</div>
</div>
</div>
<div id="section-13" class="section level1">
<h1>2023/10/16</h1>
<div id="question-4" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li><p>考虑<span class="math inline">\(m=1000\)</span>个假设，其中前95%个原假设成立，后5%个对立假设成立。在原假设之下，p值服从U(0,1)分布，在对立假设之下，p值服从Beta(0.1,
1)分布（可用rbeta生成）。应用Bonferroni校正与B-H校正应用于生成的m个p值（独立）（应用p.adjust），得到校正后的p值，与<span class="math inline">\(\alpha\)</span>=0.1比较确定是否拒绝原假设。基于M=1000次模拟，可估计FWER，FDR，TPR输出到表格中。</p></li>
<li><p>Suppose the population has the exponential distribution with rate
<span class="math inline">\(\lambda\)</span>, then the MLE of <span class="math inline">\(\lambda\)</span> is <span class="math inline">\(\hat{\lambda}=1/\bar{X}\)</span>, where <span class="math inline">\(\bar{X}\)</span> is the sample mean. It can be
derived that the expectation of <span class="math inline">\(\hat{\lambda}\)</span> is <span class="math inline">\(\lambda n/(n-1)\)</span>, so that the estimation
bias is <span class="math inline">\(\lambda/(n-1)\)</span>. The standard
error <span class="math inline">\(\hat{\lambda}\)</span> is <span class="math inline">\(\lambda n/[(n-1)\sqrt{n-2}]\)</span>. Conduct a
simulation study to verify the performance of the boostrap
method.</p></li>
</ol>
<ul>
<li>The true value of <span class="math inline">\(\lambda\)</span>=2.</li>
<li>The sample size n=51020.</li>
<li>The number of bootstrap replicates B=1000.</li>
<li>The simulations are repeated for m=1000 times.</li>
<li>Compare the mean bootstrap bias and bootstrap standard error with
the theoretical ones. Comment on the results.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Exercises 7.3 (pages 212, Statistical Computing with R).</li>
</ol>
</div>
<div id="answer-4" class="section level2">
<h2>Answer</h2>
<div id="section-14" class="section level3">
<h3>1</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>m <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>result_bfn <span class="ot">&lt;-</span> result_bh <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,M,<span class="dv">3</span>)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1000</span><span class="sc">+</span>i)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  <span class="co"># 对立假设成立为1， 原假设成立为0</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  <span class="co"># 拒绝原假设为1，不拒绝原假设为0</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  label_true <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="fl">0.95</span><span class="sc">*</span>m), <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="fl">0.05</span><span class="sc">*</span>m))</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>  p <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">runif</span>(<span class="fl">0.95</span><span class="sc">*</span>m, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">rbeta</span>(<span class="fl">0.05</span><span class="sc">*</span>m, <span class="fl">0.1</span>, <span class="dv">1</span>))</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>  <span class="co"># 校正</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>  p.bfn <span class="ot">=</span> <span class="fu">p.adjust</span>(p,<span class="at">method=</span><span class="st">&#39;bonferroni&#39;</span>)</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>  p.bh <span class="ot">=</span> <span class="fu">p.adjust</span>(p,<span class="at">method=</span><span class="st">&#39;BH&#39;</span>)</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>  <span class="co"># 获取检验结果</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>  label_bfn <span class="ot">&lt;-</span> p.bfn <span class="sc">&lt;</span> alpha</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>  label_bh <span class="ot">&lt;-</span> p.bh <span class="sc">&lt;</span> alpha</span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a>  <span class="co"># 构造混淆矩阵</span></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>  confusion_bfn <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> label_bfn, <span class="at">Actual =</span> label_true)</span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>  confusion_bh <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> label_bh, <span class="at">Actual =</span> label_true)</span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>  result_bfn[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(confusion_bfn[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">0</span>, confusion_bfn[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(confusion_bfn[<span class="dv">2</span>, ]), confusion_bh[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(confusion_bfn[, <span class="dv">2</span>]))</span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a>  result_bh[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(confusion_bh[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">0</span>, confusion_bh[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(confusion_bh[<span class="dv">2</span>, ]), confusion_bh[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(confusion_bh[, <span class="dv">2</span>]))</span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>}</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a>table <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a>  <span class="at">Bonferroni =</span> <span class="fu">colMeans</span>(result_bfn),</span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a>  <span class="at">B.H =</span> <span class="fu">colMeans</span>(result_bh),</span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;TPR&quot;</span>)</span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a>)</span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">t</span>(table))</span></code></pre></div>
<pre><code>##             FWER         FDR     TPR
## Bonferroni 0.102 0.005064083 0.56608
## B.H        0.934 0.095595186 0.56608</code></pre>
</div>
<div id="section-15" class="section level3">
<h3>2</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>sample_size <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>) <span class="co"># 采样个数</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>B <span class="ot">=</span> <span class="dv">1000</span> <span class="co"># bootstrap重复次数</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>m <span class="ot">=</span> <span class="dv">1000</span> <span class="co"># 模拟次数</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co"># 计算lambda的估计值</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>b.lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(x, i){</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(x[i])</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>}</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>total <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">2</span>) <span class="co"># 记录bootstrap估计值</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  n <span class="ot">=</span> sample_size[i]</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  matrix_temp <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2</span>)</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    x <span class="ot">=</span> <span class="fu">rexp</span>(n, <span class="dv">2</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>x, <span class="at">statistic =</span> b.lambda, <span class="at">R=</span><span class="dv">1000</span>)</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>    matrix_temp[m, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(obj<span class="sc">$</span>t)<span class="sc">-</span>obj<span class="sc">$</span>t0, <span class="fu">sd</span>(obj<span class="sc">$</span>t))</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>  }</span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>  total[i, ] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(matrix_temp)</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>}</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>table <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>  <span class="at">bias.bootstrap =</span> total[, <span class="dv">1</span>],</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>  <span class="at">bias.theoretical =</span> <span class="dv">2</span><span class="sc">/</span>(sample_size<span class="dv">-1</span>),</span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a>  <span class="at">se.bootstrap =</span> total[, <span class="dv">2</span>],</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>  <span class="at">se.theoretical =</span> <span class="dv">2</span><span class="sc">*</span>sample_size<span class="sc">/</span>((sample_size<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(sample_size<span class="dv">-2</span>)),</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>  <span class="at">row.names =</span> sample_size</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>)</span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a><span class="fu">print</span>(table)</span></code></pre></div>
<pre><code>##    bias.bootstrap bias.theoretical se.bootstrap se.theoretical
## 5       0.5841660        0.5000000    2.1742886      1.4433757
## 10      0.2161053        0.2222222    0.8035989      0.7856742
## 20      0.1052854        0.1052632    0.5091069      0.4962153</code></pre>
<p>可以看到bootstrap得到的估计值随着采样个数的增加，和理论值越来越接近。</p>
</div>
<div id="section-16" class="section level3">
<h3>3</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>boot.t.ci <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">B =</span> <span class="dv">500</span>, <span class="at">R =</span> <span class="dv">100</span>, <span class="at">level =</span> .<span class="dv">95</span>, statistic){</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="co"># 计算bootstrap的t置信区间</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x); n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  stat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B); se <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  boot.se <span class="ot">&lt;-</span> <span class="cf">function</span>(x, R, f) {</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    <span class="co">#计算bootstrap的估计标准差，f是统计量</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x); m <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    th <span class="ot">&lt;-</span> <span class="fu">replicate</span>(R, <span class="at">expr =</span> {</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>m, <span class="at">size =</span> m, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>    <span class="fu">f</span>(x[i, ])</span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>    })</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sd</span>(th))</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  }</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x[j, ]</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>    stat[b] <span class="ot">&lt;-</span> <span class="fu">statistic</span>(y)</span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>    se[b] <span class="ot">&lt;-</span> <span class="fu">boot.se</span>(y, <span class="at">R =</span> R, <span class="at">f =</span> statistic)</span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>  }</span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>  stat0 <span class="ot">&lt;-</span> <span class="fu">statistic</span>(x)</span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>  t.stats <span class="ot">&lt;-</span> (stat <span class="sc">-</span> stat0) <span class="sc">/</span> se</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>  se0 <span class="ot">&lt;-</span> <span class="fu">sd</span>(stat)</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> level</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>  Qt <span class="ot">&lt;-</span> <span class="fu">quantile</span>(t.stats, <span class="fu">c</span>(alpha<span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>), <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>  <span class="fu">names</span>(Qt) <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">names</span>(Qt))</span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>  CI <span class="ot">&lt;-</span> <span class="fu">rev</span>(stat0 <span class="sc">-</span> Qt <span class="sc">*</span> se0)</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>}</span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>dat <span class="ot">&lt;-</span> law <span class="co"># 导入数据</span></span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>stat <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a>  <span class="co"># 计算相关性的统计量</span></span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a>  <span class="fu">cor</span>(dat[,<span class="dv">1</span>], dat[,<span class="dv">2</span>])</span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a>}</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">boot.t.ci</span>(dat, <span class="at">statistic =</span> stat, <span class="at">B =</span> <span class="dv">2000</span>, <span class="at">R =</span> <span class="dv">200</span>)</span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a><span class="fu">print</span>(ci)</span></code></pre></div>
<pre><code>##        2.5%       97.5% 
## -0.09913269  0.97047524</code></pre>
<p>最终得到t置信区间为[-0.0991327, 0.9704752]。</p>
</div>
</div>
</div>
<div id="section-17" class="section level1">
<h1>2023/10/23</h1>
<div id="question-5" class="section level2">
<h2>Question</h2>
<p>Exercises 7.5 7.8 7.11 (pages 212-213, Statistical Computing with
R).</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer</h2>
<div id="section-18" class="section level3">
<h3>7.5</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>b.mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x,i){</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="fu">mean</span>(x[i])</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>}</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>obj <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>x, <span class="at">statistic =</span> b.mean, <span class="at">R=</span><span class="dv">1000</span>)</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(obj, <span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;basic&quot;</span>,<span class="st">&quot;perc&quot;</span>,<span class="st">&quot;bca&quot;</span>), <span class="at">conf=</span><span class="fl">0.95</span>)</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>ci</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = obj, conf = 0.95, type = c(&quot;norm&quot;, &quot;basic&quot;, 
##     &quot;perc&quot;, &quot;bca&quot;))
## 
## Intervals : 
## Level      Normal              Basic         
## 95%   ( 31.3, 182.1 )   ( 18.1, 171.3 )  
## 
## Level     Percentile            BCa          
## 95%   ( 44.8, 198.1 )   ( 55.9, 226.4 )  
## Calculations and Intervals on Original Scale
## Some BCa intervals may be unstable</code></pre>
<p>通过计算，可以得到standard normal, basic,
percentile和BCa方法得到的置信区间如上。
可以看到，这四种方法中，BCa的区间长度是最大的；Basic的置信区间数值整体偏小。Normal与其他方法不同，是因为其假设了数据服从正态分布，但数据本身可能不是严格正态分布的。Percentile和Basic不同，是因为相比Basic，Percentile假设了样本均值和总体均值相同，样本均值和总体均值之间的实际误差是导致这两种方法不同的原因。BCa是Percentile的改进版，考虑了变换且有二阶精度。</p>
</div>
<div id="section-19" class="section level3">
<h3>7.8</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> scor</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>cov_matrix <span class="ot">&lt;-</span> <span class="fu">cov</span>(scor, scor)</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov_matrix)<span class="sc">$</span>values</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>theta <span class="ot">&lt;-</span> lambda[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda)</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>  cov.hat <span class="ot">&lt;-</span> <span class="fu">cov</span>(x[<span class="sc">-</span>i,], x[<span class="sc">-</span>i,])</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>  lambda.hat <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov.hat)<span class="sc">$</span>values</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>  theta.hat[i] <span class="ot">&lt;-</span> lambda.hat[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda.hat)</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>}</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>bias.jack <span class="ot">=</span> (n<span class="dv">-1</span>)<span class="sc">*</span>(<span class="fu">mean</span>(theta.hat)<span class="sc">-</span>theta)</span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>se.jack <span class="ot">=</span> <span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n)<span class="sc">*</span><span class="fu">sd</span>(theta.hat)</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a><span class="fu">c</span>(<span class="at">bias.jack =</span> bias.jack, <span class="at">se.jack =</span> se.jack)</span></code></pre></div>
<pre><code>##   bias.jack     se.jack 
## 0.001069139 0.049552307</code></pre>
<p>使用jackknife估计的偏差为0.0010691，标准差为0.0495523。</p>
</div>
<div id="section-20" class="section level3">
<h3>7.11</h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">library</span>(DAAG); <span class="fu">attach</span>(ironslag)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(magnetic) <span class="co">#in DAAG ironslag</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> e2 <span class="ot">&lt;-</span> e3 <span class="ot">&lt;-</span> e4 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="co"># for n-fold cross validation</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="co"># fit models on leave-one-out samples</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n<span class="dv">-1</span>) {</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n) {</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>    y <span class="ot">&lt;-</span> magnetic[<span class="sc">-</span><span class="fu">c</span>(i, j)]</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>    x <span class="ot">&lt;-</span> chemical[<span class="sc">-</span><span class="fu">c</span>(i, j)]</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>    J1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>    yhat1 <span class="ot">&lt;-</span> J1<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J1<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[<span class="fu">c</span>(i, j)]</span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>    e1[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>((magnetic[<span class="fu">c</span>(i, j)] <span class="sc">-</span> yhat1)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>    J2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>    yhat2 <span class="ot">&lt;-</span> J2<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J2<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[<span class="fu">c</span>(i, j)] <span class="sc">+</span></span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>    J2<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> chemical[<span class="fu">c</span>(i, j)]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>    e2[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>((magnetic[<span class="fu">c</span>(i, j)] <span class="sc">-</span> yhat2)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>    J3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> x)</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>    logyhat3 <span class="ot">&lt;-</span> J3<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J3<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[<span class="fu">c</span>(i, j)]</span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>    yhat3 <span class="ot">&lt;-</span> <span class="fu">exp</span>(logyhat3)</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>    e3[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>((magnetic[<span class="fu">c</span>(i, j)] <span class="sc">-</span> yhat3)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>    J4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> <span class="fu">log</span>(x))</span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>    logyhat4 <span class="ot">&lt;-</span> J4<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">log</span>(chemical[<span class="fu">c</span>(i, j)])</span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    yhat4 <span class="ot">&lt;-</span> <span class="fu">exp</span>(logyhat4)</span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>    e4[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>((magnetic[<span class="fu">c</span>(i, j)] <span class="sc">-</span> yhat4)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a>    k <span class="ot">=</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>  }</span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>}</span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a>table <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a>  <span class="at">J1 =</span> <span class="fu">mean</span>(e1),</span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a>  <span class="at">J2 =</span> <span class="fu">mean</span>(e2),</span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>  <span class="at">J3 =</span> <span class="fu">mean</span>(e3),</span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>  <span class="at">J4 =</span> <span class="fu">mean</span>(e4),</span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="st">&quot;MSE&quot;</span></span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>)</span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a><span class="fu">print</span>(table)</span></code></pre></div>
<pre><code>##           J1       J2       J3       J4
## MSE 19.58344 17.87719 18.46252 20.47674</code></pre>
<p>其中，Quadratic模型J1的MSE最小，Quadratic模型效果最好。Log-Log模型J4的MSE最大，效果最差。</p>
</div>
</div>
</div>
<div id="section-21" class="section level1">
<h1>2023/10/30</h1>
<div id="question-6" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li>Proof the Stationarity of Metropolis-Hastings sampler Algorithm in
continuous situation.</li>
<li>Exercises 8.1 8.3 (pages 242-243, Statistical Computing with
R).</li>
</ol>
</div>
<div id="answer-6" class="section level2">
<h2>Answer</h2>
<div id="section-22" class="section level3">
<h3>1</h3>
<p>令目标分布为<span class="math inline">\(f(x)\)</span>，<span class="math inline">\(r\)</span>和<span class="math inline">\(s\)</span>是状态空间中的两个取值。状态<span class="math inline">\(r\)</span>的提议分布为<span class="math inline">\(g(\cdot|r)\)</span>，接受概率为</p>
<p><span class="math display">\[
\alpha(r, s) = \min(1, \frac{f(s)g(r|s)}{f(r)g(s|r)}).
\]</span></p>
<p>则传递核为</p>
<p><span class="math display">\[
K(r, s) = \alpha(r, s)g(s|r) + I(s=r)[1-\int_{s \neq r}\alpha(r,
s)g(s|r)ds].
\]</span></p>
<p>下面证明</p>
<p><span class="math display">\[
f(s)K(s, r) = f(r)K(r, s).
\]</span></p>
<p>先求左半边，</p>
<p><span class="math display">\[
f(r)\alpha(r, s)g(s|r) =
\begin{cases}
f(r)g(s|r)\frac{f(s)g(r|s)}{f(r)g(s|r)}=f(s)g(s|r), &amp; f(r)g(s|r)
\geq f(s)g(r|s)\\
f(r)g(r|s), &amp; f(r)g(s|r) \leq f(s)g(r|s),
\end{cases}
\]</span></p>
<p>而从状态<span class="math inline">\(s\)</span>出发可以得到</p>
<p><span class="math display">\[
f(s)\alpha(s, r)g(r|s) =
\begin{cases}
  f(s)g(r|s) &amp; f(r)g(s|r) \geq f(s)g(r|s)\\
  f(s)g(r|s)\frac{f(r)g(s|r)}{f(s)g(r|s)}=f(r)g(s|r), &amp; f(r)g(s|r)
\leq f(s)g(r|s),
\end{cases}
\]</span></p>
<p><span class="math display">\[
f(r)\alpha(r, s)g(s|r) =
\begin{cases}
    f(r)g(s|r)\frac{f(s)g(r|s)}{f(r)g(s|r)} = f(s)g(s|r), &amp; \text{if
} f(r)g(s|r) \geq f(s)g(r|s)\\
    f(s)g(s|r), &amp; \text{if } f(r)g(s|r) \leq f(s)g(r|s),
\end{cases}
\]</span></p>
<p>所以可以得到</p>
<p><span class="math display">\[
f(s)\alpha(s, r)g(r|s) = f(r)\alpha(r, s)g(s|r).
\]</span></p>
<p>下面看右半部分，当<span class="math inline">\(r =
s\)</span>时，下面的等式是显然的</p>
<p><span class="math display">\[
f(r)I(s=r)[1-\int_{s \neq r}\alpha(r, s)g(s|r)ds] = f(s)I(r=s)[1-\int_{r
\neq s}\alpha(s, r)g(r|s)dr].
\]</span></p>
<p>所以</p>
<p><span class="math display">\[
f(s)K(s, r) = f(r)K(r, s).
\]</span></p>
<p>证毕。</p>
</div>
<div id="section-23" class="section level3">
<h3>8.1</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="fu">attach</span>(chickwts)</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;soybean&quot;</span>]))</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;linseed&quot;</span>]))</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="fu">detach</span>(chickwts)</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  ecdf1 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(x)</span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>  ecdf2 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(y)</span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a>  sum1 <span class="ot">=</span> <span class="fu">sum</span>((<span class="fu">ecdf1</span>(x)<span class="sc">-</span><span class="fu">ecdf2</span>(x))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>  sum2 <span class="ot">=</span> <span class="fu">sum</span>((<span class="fu">ecdf1</span>(y)<span class="sc">-</span><span class="fu">ecdf2</span>(y))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>  <span class="fu">return</span>(m<span class="sc">*</span>n<span class="sc">/</span>(m<span class="sc">+</span>n)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(sum1<span class="sc">+</span>sum2))</span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a>}</span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">999</span> <span class="co">#number of replicates</span></span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y) <span class="co">#pooled sample</span></span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span></span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">numeric</span>(R) <span class="co">#storage for replicates</span></span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">w</span>(x, y)</span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a>  <span class="co">#generate indices k for the first sample</span></span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">sample</span>(K, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-25"><a href="#cb41-25" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> z[k]</span>
<span id="cb41-26"><a href="#cb41-26" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> z[<span class="sc">-</span>k] <span class="co">#complement of x1</span></span>
<span id="cb41-27"><a href="#cb41-27" tabindex="-1"></a>  D[i] <span class="ot">&lt;-</span> <span class="fu">w</span>(x1, y1)</span>
<span id="cb41-28"><a href="#cb41-28" tabindex="-1"></a>}</span>
<span id="cb41-29"><a href="#cb41-29" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(D0, D) <span class="sc">&gt;=</span> D0)</span>
<span id="cb41-30"><a href="#cb41-30" tabindex="-1"></a>p</span></code></pre></div>
<pre><code>## [1] 0.408</code></pre>
<p>最终得到的p值为0.408，结果不显著，不拒绝soybean和linseed分布相同的假设。</p>
</div>
<div id="section-24" class="section level3">
<h3>8.3</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> mu2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n1, mu1, sigma1)</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n2, mu2, sigma2)</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>count5test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>  X <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">mean</span>(x)</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>  outx <span class="ot">&lt;-</span> <span class="fu">sum</span>(X <span class="sc">&gt;</span> <span class="fu">max</span>(Y)) <span class="sc">+</span> <span class="fu">sum</span>(X <span class="sc">&lt;</span> <span class="fu">min</span>(Y))</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>  outy <span class="ot">&lt;-</span> <span class="fu">sum</span>(Y <span class="sc">&gt;</span> <span class="fu">max</span>(X)) <span class="sc">+</span> <span class="fu">sum</span>(Y <span class="sc">&lt;</span> <span class="fu">min</span>(X))</span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">max</span>(<span class="fu">c</span>(outx, outy)))</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>}</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">999</span> <span class="co">#number of replicates</span></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y) <span class="co">#pooled sample</span></span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(n1<span class="sc">+</span>n2)</span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">numeric</span>(R) <span class="co">#storage for replicates</span></span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">count5test</span>(x, y)</span>
<span id="cb43-21"><a href="#cb43-21" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb43-22"><a href="#cb43-22" tabindex="-1"></a>  <span class="co">#generate indices k for the first sample</span></span>
<span id="cb43-23"><a href="#cb43-23" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">sample</span>(K, <span class="at">size =</span> n1, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-24"><a href="#cb43-24" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> z[k]</span>
<span id="cb43-25"><a href="#cb43-25" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> z[<span class="sc">-</span>k] <span class="co">#complement of x1</span></span>
<span id="cb43-26"><a href="#cb43-26" tabindex="-1"></a>  D[i] <span class="ot">&lt;-</span> <span class="fu">count5test</span>(x1, y1)</span>
<span id="cb43-27"><a href="#cb43-27" tabindex="-1"></a>}</span>
<span id="cb43-28"><a href="#cb43-28" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(D0, D) <span class="sc">&gt;=</span> D0)</span>
<span id="cb43-29"><a href="#cb43-29" tabindex="-1"></a>p</span></code></pre></div>
<pre><code>## [1] 0.917</code></pre>
<p>从多次实验的结果来看，p值的非常不稳定，p值可能的区间大概在[0.1,
1]。总的来看，p值较大，不应当拒绝方差相同的假设。分析p值不稳定的原因，应当是count5test这个统计量的取值是整数，每当原始x和y的统计量产生波动时，会对结果产生很大影响。</p>
</div>
</div>
</div>
<div id="section-25" class="section level1">
<h1>2023/11/06</h1>
<div id="question-7" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li>考虑模型 <span class="math inline">\(P(Y = 1 | X1, X2, X3) =
\frac{exp(a+b1X1+b2X2+b3X3)}{1+exp(a+b1X1+b2X2+b3X3)}\)</span> , 其中
<span class="math inline">\(X1 ∼ P(1), X2 ∼ Exp(1), X3 ∼ B(1,
0.5)\)</span>.</li>
</ol>
<ul>
<li>设计一个函数输入为 N, b1, b2, b3 和 f0, 输出为 a.</li>
<li>调用函数, 输入的值为 N = 106, b1 = 0, b2 = 1, b3 = −1, f0 = 0.1,
0.01, 0.001, 0.0001.</li>
<li>用 − log f0 vs a 画图.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Exercises 9.4 9.7 9.10 (pages 277-278, Statistical Computing with
R).</li>
</ol>
</div>
<div id="answer-7" class="section level2">
<h2>Answer</h2>
<div id="section-26" class="section level3">
<h3>1</h3>
<p>定义的函数如下</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>logistica <span class="ot">&lt;-</span> <span class="cf">function</span>(N, b1, b2, b3, f0){ </span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(N, <span class="dv">1</span>) </span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">rexp</span>(N, <span class="dv">1</span>)</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(N, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  gg <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha){ <span class="co"># 内置函数</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>    t <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>alpha<span class="sc">-</span>b1<span class="sc">*</span>x1<span class="sc">-</span>b2<span class="sc">*</span>x2<span class="sc">-</span>b3<span class="sc">*</span>x3)</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>t)</span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>    <span class="fu">mean</span>(p)<span class="sc">-</span>f0</span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>  }</span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(gg, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">0</span>)) <span class="co"># 使用uniroot求方程的根</span></span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>}</span></code></pre></div>
<p>下面调用上述函数，使用如下的输入值来计算a的值</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>N <span class="ot">=</span> <span class="fl">1e6</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>b1 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>b2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>b3 <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>f0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>)</span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">4</span>) <span class="co"># 记录a的值</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>  a[i] <span class="ot">=</span> <span class="fu">logistica</span>(N, b1, b2, b3, f0[i])<span class="sc">$</span>root</span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a>}</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a>table <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">f0=</span>f0, <span class="at">a=</span>a)</span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(table, <span class="dv">4</span>))</span></code></pre></div>
<pre><code>##      f0        a
## 1 1e-01  -2.9494
## 2 1e-02  -5.8520
## 3 1e-03  -8.5025
## 4 1e-04 -11.0810</code></pre>
<p>最终得到的a值如表格所示，下面绘制 −log f0 vs a的图</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="sc">-</span><span class="fu">log</span>(f0), a, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>可以看到−log f0 和 a的关系是线性的，a随−log f0增大而递减。</p>
</div>
<div id="section-27" class="section level3">
<h3>9.4</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co"># laplace分布概率密度函数</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>laplace <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>  <span class="fl">0.5</span><span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(x))</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>}</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a><span class="co"># random walk metropolis 采样</span></span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>rw.Metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, x0, N) {</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a>  x[<span class="dv">1</span>] <span class="ot">&lt;-</span> x0  <span class="co"># markov chain的第一个值</span></span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, x[i<span class="dv">-1</span>], sigma)</span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>    <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> (<span class="fu">laplace</span>(y) <span class="sc">/</span> <span class="fu">laplace</span>(x[i<span class="dv">-1</span>]))){ <span class="co"># 接受</span></span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a>      x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># 拒绝</span></span>
<span id="cb49-17"><a href="#cb49-17" tabindex="-1"></a>      x[i] <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb49-18"><a href="#cb49-18" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb49-19"><a href="#cb49-19" tabindex="-1"></a>    }</span>
<span id="cb49-20"><a href="#cb49-20" tabindex="-1"></a>  }</span>
<span id="cb49-21"><a href="#cb49-21" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x=</span>x, <span class="at">k=</span>k))</span>
<span id="cb49-22"><a href="#cb49-22" tabindex="-1"></a>}</span>
<span id="cb49-23"><a href="#cb49-23" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="co"># 迭代步数</span></span>
<span id="cb49-25"><a href="#cb49-25" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">16</span>) <span class="co"># 方差</span></span>
<span id="cb49-26"><a href="#cb49-26" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># markov chain的第一个值</span></span>
<span id="cb49-27"><a href="#cb49-27" tabindex="-1"></a>rw1 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">1</span>], x0, N)</span>
<span id="cb49-28"><a href="#cb49-28" tabindex="-1"></a>rw2 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">2</span>], x0, N)</span>
<span id="cb49-29"><a href="#cb49-29" tabindex="-1"></a>rw3 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">3</span>], x0, N)</span>
<span id="cb49-30"><a href="#cb49-30" tabindex="-1"></a>rw4 <span class="ot">&lt;-</span> <span class="fu">rw.Metropolis</span>(sigma[<span class="dv">4</span>], x0, N)</span>
<span id="cb49-31"><a href="#cb49-31" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" tabindex="-1"></a>index <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span></span>
<span id="cb49-33"><a href="#cb49-33" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb49-34"><a href="#cb49-34" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb49-35"><a href="#cb49-35" tabindex="-1"></a><span class="fu">plot</span>(index, rw1<span class="sc">$</span>x, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;sigma=.05&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb49-36"><a href="#cb49-36" tabindex="-1"></a><span class="fu">plot</span>(index, rw2<span class="sc">$</span>x, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;sigma=.5&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb49-37"><a href="#cb49-37" tabindex="-1"></a><span class="fu">plot</span>(index, rw3<span class="sc">$</span>x, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;sigma=2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb49-38"><a href="#cb49-38" tabindex="-1"></a><span class="fu">plot</span>(index, rw4<span class="sc">$</span>x, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;sigma=16&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>上面分别是是<span class="math inline">\(\sigma\)</span>取0.05,0.5,
2,16得到的Markov Chain的迭代值。可以看到，当<span class="math inline">\(\sigma=0.05\)</span>时，Markov
Chain收敛非常慢，在2000步内没有收敛。随着<span class="math inline">\(\sigma\)</span>增大，收敛速度变快。但是当<span class="math inline">\(\sigma=16\)</span>时，出现大量连续的重复值。</p>
<p>下面计算各个<span class="math inline">\(\sigma\)</span>取值下的接受率，</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>accptance <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">4</span>)</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>accptance[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>rw1<span class="sc">$</span>k<span class="sc">/</span>N</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>accptance[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>rw2<span class="sc">$</span>k<span class="sc">/</span>N</span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a>accptance[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>rw3<span class="sc">$</span>k<span class="sc">/</span>N</span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>accptance[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>rw4<span class="sc">$</span>k<span class="sc">/</span>N</span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a>table.accptance <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sigma =</span> sigma, <span class="at">apptance.rate =</span> accptance)</span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>table.accptance</span></code></pre></div>
<pre><code>##   sigma apptance.rate
## 1  0.05        0.9815
## 2  0.50        0.8465
## 3  2.00        0.5105
## 4 16.00        0.0945</code></pre>
<p>可以看到，<span class="math inline">\(\sigma\)</span>越大，接受率越低。</p>
</div>
<div id="section-28" class="section level3">
<h3>9.7</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># 初始化参数</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span> <span class="co"># markov chain的长度</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># burn-in 长度</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>) <span class="co"># 记录markov chain</span></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.9</span> <span class="co"># 相关系数</span></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># 均值</span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>mu2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 方差</span></span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>sigma1 <span class="co"># 边缘分布的方差</span></span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>sigma2</span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>X[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(mu1, mu2) <span class="co"># 初始化</span></span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb52-16"><a href="#cb52-16" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> mu1 <span class="sc">+</span> rho <span class="sc">*</span> (x2 <span class="sc">-</span> mu2) <span class="sc">*</span> sigma1<span class="sc">/</span>sigma2</span>
<span id="cb52-17"><a href="#cb52-17" tabindex="-1"></a>  X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, m1, s1)</span>
<span id="cb52-18"><a href="#cb52-18" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb52-19"><a href="#cb52-19" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> mu2 <span class="sc">+</span> rho <span class="sc">*</span> (x1 <span class="sc">-</span> mu1) <span class="sc">*</span> sigma2<span class="sc">/</span>sigma1</span>
<span id="cb52-20"><a href="#cb52-20" tabindex="-1"></a>  X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, m2, s2)</span>
<span id="cb52-21"><a href="#cb52-21" tabindex="-1"></a>}</span>
<span id="cb52-22"><a href="#cb52-22" tabindex="-1"></a>b <span class="ot">&lt;-</span> burn <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb52-23"><a href="#cb52-23" tabindex="-1"></a>x <span class="ot">&lt;-</span> X[b<span class="sc">:</span>N, ] <span class="co"># 去除burn-in部分的markov chain</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">cex=</span>.<span class="dv">5</span>, <span class="at">xlab=</span><span class="fu">bquote</span>(X), <span class="at">ylab=</span><span class="fu">bquote</span>(Y), <span class="at">ylim=</span><span class="fu">range</span>(x[,<span class="dv">2</span>]))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(x[, <span class="dv">2</span>]<span class="sc">~</span>x[, <span class="dv">1</span>])</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = x[, 2] ~ x[, 1])
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.66840 -0.29130 -0.00481  0.29158  1.48835 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.004543   0.006848  -0.663    0.507    
## x[, 1]       0.899988   0.006772 132.893   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4329 on 3998 degrees of freedom
## Multiple R-squared:  0.8154, Adjusted R-squared:  0.8154 
## F-statistic: 1.766e+04 on 1 and 3998 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">shapiro.test</span>(model<span class="sc">$</span>residuals)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  model$residuals
## W = 0.99954, p-value = 0.4865</code></pre>
<p>在置信水平为0.05的情况下，不拒绝正态性假设，残差是服从正态分布的。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(model<span class="sc">$</span>residuals)</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>se</span></code></pre></div>
<pre><code>## [1] 0.4328728</code></pre>
<p>残差的标准差为0.4328728。</p>
</div>
<div id="section-29" class="section level3">
<h3>9.10</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="co"># 目标分布</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sigma) {</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>)) { <span class="co"># 定义域x大于0</span></span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>    <span class="fu">return</span> (<span class="dv">0</span>)</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>  }</span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sigma <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="co"># sigma需要大于0</span></span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a>  <span class="fu">return</span>((x <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>}</span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a><span class="co"># Gelman.Rubin方法</span></span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a>Gelman.Rubin <span class="ot">&lt;-</span> <span class="cf">function</span>(psi) {</span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a>  psi <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(psi) <span class="co"># psi是markov chain的统计量</span></span>
<span id="cb60-13"><a href="#cb60-13" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(psi)</span>
<span id="cb60-14"><a href="#cb60-14" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">nrow</span>(psi)</span>
<span id="cb60-15"><a href="#cb60-15" tabindex="-1"></a>  psi.means <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(psi) <span class="co">#行均值</span></span>
<span id="cb60-16"><a href="#cb60-16" tabindex="-1"></a>  B <span class="ot">&lt;-</span> n <span class="sc">*</span> <span class="fu">var</span>(psi.means) <span class="co">#between variance est.</span></span>
<span id="cb60-17"><a href="#cb60-17" tabindex="-1"></a>  psi.w <span class="ot">&lt;-</span> <span class="fu">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>) <span class="co">#within variances</span></span>
<span id="cb60-18"><a href="#cb60-18" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">mean</span>(psi.w) <span class="co">#within est.</span></span>
<span id="cb60-19"><a href="#cb60-19" tabindex="-1"></a>  v.hat <span class="ot">&lt;-</span> W<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>n <span class="sc">+</span> (B<span class="sc">/</span>n) <span class="co">#方差的上界</span></span>
<span id="cb60-20"><a href="#cb60-20" tabindex="-1"></a>  r.hat <span class="ot">&lt;-</span> v.hat <span class="sc">/</span> W <span class="co">#G-R 统计量</span></span>
<span id="cb60-21"><a href="#cb60-21" tabindex="-1"></a>  <span class="fu">return</span>(r.hat)</span>
<span id="cb60-22"><a href="#cb60-22" tabindex="-1"></a>}</span>
<span id="cb60-23"><a href="#cb60-23" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" tabindex="-1"></a><span class="co"># 参数</span></span>
<span id="cb60-25"><a href="#cb60-25" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> .<span class="dv">2</span> <span class="co"># 提议分布的参数</span></span>
<span id="cb60-26"><a href="#cb60-26" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co">#chain的数量</span></span>
<span id="cb60-27"><a href="#cb60-27" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co">#burn-in长度</span></span>
<span id="cb60-28"><a href="#cb60-28" tabindex="-1"></a></span>
<span id="cb60-29"><a href="#cb60-29" tabindex="-1"></a><span class="co">#生成初始值</span></span>
<span id="cb60-30"><a href="#cb60-30" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb60-31"><a href="#cb60-31" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(k, <span class="at">df=</span><span class="dv">1</span>)</span>
<span id="cb60-32"><a href="#cb60-32" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(x0) <span class="co"># 记录markov chain</span></span>
<span id="cb60-34"><a href="#cb60-34" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">matrix</span>(x0) <span class="co"># 记录统计量</span></span>
<span id="cb60-35"><a href="#cb60-35" tabindex="-1"></a>R.hat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># 初始化R.hat，使其大于1.2</span></span>
<span id="cb60-36"><a href="#cb60-36" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">2</span> <span class="co"># chain的长度</span></span>
<span id="cb60-38"><a href="#cb60-38" tabindex="-1"></a><span class="cf">while</span> (R.hat <span class="sc">&gt;=</span> <span class="fl">1.2</span>) { <span class="co"># 循环直到R.hat大于1.2，实现了控制</span></span>
<span id="cb60-39"><a href="#cb60-39" tabindex="-1"></a>  xt <span class="ot">&lt;-</span> X[, i<span class="dv">-1</span>]</span>
<span id="cb60-40"><a href="#cb60-40" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(k, <span class="at">df =</span> xt)</span>
<span id="cb60-41"><a href="#cb60-41" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">f</span>(y, sigma) <span class="sc">*</span> <span class="fu">dchisq</span>(xt, <span class="at">df =</span> y)</span>
<span id="cb60-42"><a href="#cb60-42" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="fu">f</span>(xt, sigma) <span class="sc">*</span> <span class="fu">dchisq</span>(y, <span class="at">df =</span> xt)</span>
<span id="cb60-43"><a href="#cb60-43" tabindex="-1"></a>  flag <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">4</span>) <span class="sc">&lt;=</span> r1<span class="sc">/</span>r2 <span class="co"># 这里flag用来表示时候接受提议分布</span></span>
<span id="cb60-44"><a href="#cb60-44" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X, flag<span class="sc">*</span>y<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>flag)<span class="sc">*</span>xt) <span class="co"># 将拒绝或接受的值加入</span></span>
<span id="cb60-45"><a href="#cb60-45" tabindex="-1"></a>  psi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(psi, psi[, i<span class="dv">-1</span>]<span class="sc">+</span>(X[, i]<span class="sc">-</span>psi[, i<span class="dv">-1</span>])<span class="sc">/</span>i) <span class="co"># 更新统计量</span></span>
<span id="cb60-46"><a href="#cb60-46" tabindex="-1"></a>  R.hat <span class="ot">&lt;-</span> <span class="fu">Gelman.Rubin</span>(psi)</span>
<span id="cb60-47"><a href="#cb60-47" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb60-48"><a href="#cb60-48" tabindex="-1"></a>}</span>
<span id="cb60-49"><a href="#cb60-49" tabindex="-1"></a></span>
<span id="cb60-50"><a href="#cb60-50" tabindex="-1"></a><span class="fu">print</span>(R.hat)</span></code></pre></div>
<pre><code>## [1] 1.19997</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">ncol</span>(psi)</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a><span class="co">#画chain</span></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a>  <span class="fu">plot</span>(psi[i, (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span>i, <span class="at">ylab=</span><span class="fu">bquote</span>(psi))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#restore default</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a><span class="co">#画R-hat statistics</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>rhat <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n)</span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>  rhat[j] <span class="ot">&lt;-</span> <span class="fu">Gelman.Rubin</span>(psi[,<span class="dv">1</span><span class="sc">:</span>j])</span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a><span class="fu">plot</span>(rhat[(b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;R&quot;</span>)</span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">1.1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAQlBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6AGY6kNtmAABmtv+QOgCQ2/+2ZgC2///bkDrb////tmb/25D//7b//9v////ed2O8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAG7klEQVR4nO2c2VbbShBFlUByIQ4xAvP/v3ptyzOWTrurqvu0dPYLrNCT9uqhNFS6LzFJV3sA7EgQQIIAEgSQIIAEASQIIEEACQJIEECCABIEkCCABAEkCCBBAAkCSBBAggASBJAggAQBJAggQQAJAkgQQIIAEgSQIIAEASQIIEEACQJIEECCABIEkCCABAEkCCBBAAkCSBBAggASBJAggAQBJAggQQAJAkgQQIIAEgSQIIAEASQIIEGAfEFdU9QQlF2zAhIEkCCABAEkCFBPUCOaKs6gNgzVFNSEoZp7UBOGqm7SLRiqe4pJEKrJb6i2IHpDtQNFekO1BdEvsuqC2A3VF0RuiEAQtyEKQcyGGARRG6IQxGyIQxCxIRJBvBs1iyBaQzSCWA3xCCI1VFAQepvLuVETzSBOQ0yCKFcZmSA+Q1yCCA2RCeIzxCaIzhCdILaNmk8Q2RwKuMzNaggHf/7L7JPKkL+gdfcy/NIff3m4z1kL2qxOWtZP75l9EhlyF/T5+uf4az+yyBL65DHEOYOIDEXsQYcplL8HJRcqQMAp9vk6nGIj8ye1TxJDhHHQqRiFImJBHHMo4DLX2+W134bW+afYoSCBooBN+sff7Tb0/OUgiMFQ0DG/WW23aLsgAkNhgeLb07uDoPqG4gLFt2cPQdUNBexBBy3bcMhDUG1DIafYsMg2KxdBlQ0xx0Gn8jUNtSCoqiHqQPFco56hgoGiJdO6niHyQPFcp5Yh9kDRVskB+kDxXKuOIv5A8VytiqEGAkVzPRNNxEH2LvNpSlCNVRZ5mb6b9FC1uKG2ZlCFVdaaoOJzqDlBpQ21J6jwKmtQUNk5FHAvdr5r9z/FDg0UNOQ/D0YDaIc+/Voo0NVozc3qOarPcxPFFEXsJH33Z/Rvtj4v2ihlqMVNemikkKFmBZUy1K6gQoYaFlTmMGtbUAFDTQsqMYcaFxRvqHVB4cuseUHRhtoXFGyo6Dca5v8Ffaxh5wavGm+q5liDgYZmISjyMJuLoDBDMxEUN4dmIyjK0HwE0XmnExSzEc1JUIihkIf2xrz5fAIM+QtyyJvPx9+QuyCnrOds3O9jvGv65M0b8L4V9q5ZewZ5L7OIPcglb96Aq6GAU8wpb96Ap6FZxUHnHvy6mKcgindv3ILcOpmtIK9lFhAHxX9hloaPIf95UOILszRcDIXcrMZ/YZaGh6GInaTEF2ZpOBia7yY9dGXua+aC7J3NXpC1t4DLDMibN2HrLuBuPiJv3oSpw6DnQe558yaoBEXlzZswzKG4J4reefMm8g0F7EFRefMmsg2FnGJBefMmcg0RLc5gMg0tR1CmocjLJNqkh35zOl7QDMoztChBOYaWJSjD0MIEPW5oaYIeNjTjtxoj1BZE9FbDpftZv9UY6/+RAcz7rcbYAB4YweI26UdHsExBDwxhoYLSV9lSBSUPYrGCUkexXEGJq2zBgtLGsWRBSQNZtKCUkRS8zGqvnifAY1n2DEoYy9IFwcEsXhBaZRIEhiNBYDwS9DU9IAnaMTEiCdozPqSQZ9LV0sLzGR2Tv6CqaeH5jA3KXVD9pN5MRkYV8OKwclp4NveHpRl05u64Ivag2mnh2dwbWMApVj8tPJd7t2WKgy65Y0iCrvk2NgWK13ybQwoUb7g1pGP+lhtDChS/cW1IM+g7V4YUKN7h0pACxXtcGFIcdBcJQnTffslv4ha2tPA8upuf+S3cwpcWnkd39SO/gVsY08IthAWKVGnhBuICRaq08HwC9iDKtPBsQk4xxrTwXBQHAaoIaopAQWObdGr9rLIxRXOwNi9BjvUlyK+sBFUpmoME5TWfkBY+Wd9all5QQlr4dH1jWX5BOC0c1LeVbUAQTAtfCE3dUdVAggASBJAggAQBJAggQQAJAkgQQIIAEgSQIIBJUN91P/6iQh///bsqO1Zp/2H2S1LR3bc5NyWShpKDRVC/HVKPhvX5un+wdCo7Vmmz2v7juntOKLp/E3VdImkoWRgEDR84vE0/NuqHJ5KnsqOVPn7tnq5sLx0X/Xx9GZ5X4aJ2DIJOlzRRpu9e9t9Zn8qCSttZkFh0Jyi1VQsWQb93U3rsO/MTg6BjWVDp7aLEdNHdJ3CprVowCBrWPFz5+2Gfyk5X2n2UnVS03+/nia2aoBLUH/fohKvefR5ILsh9iQ0f9aeum912xb3EEnfG5E36kIGVuvNu/0y+SSeerX3aMX/xSVtaRNCnRAR2wgPFw8SHId3Hr2PSDI7+3p7eByfcgeJFxD/FYWc4lR2ptB7ec+/+hIpuDXXHNABY1IpuVgESBJAggAQBJAggQQAJAkgQQIIAEgSQIIAEASQIIEEACQJIEECCABIEkCCABAEkCCBBAAkC/A+y8gtqhuNihAAAAABJRU5ErkJggg==" /><!-- --></p>
<p>上面在<span class="math inline">\(R.hat&lt;1.2\)</span>时停止了迭代，下面使用coda包来检验生成的Markov
Chain是否收敛。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>mcmclist <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(<span class="fu">mcmc</span>(X[<span class="dv">1</span>, ]), <span class="fu">mcmc</span>(X[<span class="dv">2</span>, ]), <span class="fu">mcmc</span>(X[<span class="dv">3</span>, ]), <span class="fu">mcmc</span>(X[<span class="dv">4</span>, ]))</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a><span class="fu">gelman.diag</span>(mcmclist)</span></code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##      Point est. Upper C.I.
## [1,]       1.01       1.02</code></pre>
<p>可以看到点估计量为1，0.95的置信区间上界为1，可以认为Markov
Chain已经收敛。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">gelman.plot</span>(mcmclist)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
</div>
<div id="section-30" class="section level1">
<h1>2023/11/13</h1>
<div id="question-8" class="section level2">
<h2>Question</h2>
<p>1.设<span class="math inline">\(X_1, \ldots, X_n
\overset{iid}{\sim}Exp(\lambda)\)</span>。因为某些原因，只知<span class="math inline">\(X_i\)</span>落在某个区间<span class="math inline">\((u_i, v_i)\)</span>，其中<span class="math inline">\(u_i &lt;
v_i\)</span>是两个非随机的已知常数。这种数据称为区间删失数据。</p>
<p>(1)尝试分别直接极大化观测数据的似然函数与采用EM算法求解<span class="math inline">\(\lambda\)</span>的MLE，证明EM算法收敛于观测数据的MLE，且收敛有线性速度。</p>
<p>(2)设<span class="math inline">\((u_i, v_i),i =
1,\ldots,n(=10)\)</span>的观测值为<span class="math inline">\((11,12),(8,9),(27,28),(13,14),(16,17),(0,1),(23,24),(10,11),(24,25),(2,3)\)</span>。试分别编成实现上述两种算法以得到<span class="math inline">\(\lambda\)</span>的MLE的数值解。</p>
<p>提示：观测数据的似然函数为<span class="math inline">\(L(\lambda)=\prod_{i=1}^{n}P_r(u_i \leq X_i \leq
v_i)\)</span> 。</p>
<p>2.Exercises 11.8 (pages 354, Statistical Computing with R).</p>
</div>
<div id="answer-8" class="section level2">
<h2>Answer</h2>
<div id="section-31" class="section level3">
<h3>1</h3>
<p>（1）</p>
<p>MLE：</p>
<p>似然函数为</p>
<p><span class="math display">\[
L(\lambda) = \prod_{i=1}^{n}P_{\lambda}( u_i \leq X_i \leq
v_i)=\prod_{i=1}^{n}(e^{-\lambda u_i}-e^{-\lambda v_i}),
\]</span></p>
<p>对数似然函数为</p>
<p><span class="math display">\[
l(\lambda) = \sum_{i=1}^{n} \log(e^{-\lambda u_i}-e^{-\lambda v_i}).
\]</span></p>
<p>当满足</p>
<p><span class="math display">\[
\frac{\partial l(\lambda)}{\partial \lambda} = \sum_{i=1}^{n} \frac{-u_i
e^{-\lambda u_i}+ v_i e^{-\lambda v_i}}{e^{-\lambda u_i}-e^{-\lambda
v_i}}=0,
\]</span></p>
<p>此时的<span class="math inline">\(\lambda ^*\)</span>为MLE。</p>
<p><br /></p>
<p>EM：</p>
<p>变量<span class="math inline">\(X_i\)</span>的观测值<span class="math inline">\(x_i\)</span>是未知的，在观测值为<span class="math inline">\(x_i\)</span>时的似然函数为</p>
<p><span class="math display">\[
L(\lambda|X_i) = \prod_{i=1}^{n} \lambda e^{-\lambda x_i}=\lambda^n
\prod_{i=1}^{n} e^{-\lambda x_i}.
\]</span></p>
<p>对数似然函数为</p>
<p><span class="math display">\[
l(\lambda|X_i) = n \log{\lambda} - \lambda \sum_{i=1}^{n}x_i.
\]</span></p>
<p>在已知<span class="math inline">\(u_i, v_i\)</span>的情况下</p>
$$
<span class="math display">\[\begin{aligned}
E[X_i|u_i,v_i] &amp;= \int_{u_i}^{v_i} x_i \frac{\lambda e^{-\lambda
x_i}}{\int_{u_i}^{v_i}\lambda e^{-\lambda x_i}d x_i} d x_i \\
&amp;=   \frac{u_i e^{-\lambda u_i}- v_i e^{-\lambda v_i}}{e^{-\lambda
u_i}-e^{-\lambda v_i}} + \frac{1}{\lambda}   .
\end{aligned}\]</span>
<p>$$</p>
<p>E步：</p>
<p><span class="math display">\[
E_{\lambda_0}[l(\lambda|X_i) | u_i, v_i] = n \log \lambda -\lambda
\sum_{i=1}^{n}E_{\lambda_0}[X_i|u_i,v_i].
\]</span></p>
<p>M步：</p>
<p><span class="math display">\[
\frac{\partial E_{\lambda_0}[l(\lambda|X_i) | u_i, v_i]}{\partial
\lambda} = \frac{n}{\lambda} -
\sum_{i=1}^{n}E_{\lambda_0}[X_i|u_i,v_i]=0.
\]</span></p>
<p>得到</p>
<p><span class="math display">\[
\lambda_1 = \frac{n}{\sum_{i=1}^{n}E_{\lambda_0}[X_i|u_i,v_i]},
\]</span></p>
<p>由此可以得到EM算法的迭代格式</p>
<p><span class="math display">\[
\lambda_{t+1} = \frac{1}{\frac{1}{n}\sum_{i=1}^{n}\frac{u_i
e^{-\lambda_{t} u_i}- v_i e^{-\lambda_{t} v_i}}{e^{-\lambda_{t}
u_i}-e^{-\lambda_{t} v_i}} + \frac{1}{\lambda_{t}}}.
\]</span></p>
<p><br /></p>
<p>可以简单验证得到，当EM算法收敛时，将MEL <span class="math inline">\(\lambda^*\)</span>带入EM算法，</p>
<p><span class="math display">\[
\frac{1}{\frac{1}{n}\sum_{i=1}^{n}\frac{u_i e^{-\lambda_* u_i}- v_i
e^{-\lambda_* v_i}}{e^{-\lambda_* u_i}-e^{-\lambda_* v_i}} +
\frac{1}{\lambda_*}} = \frac{1}{\frac{1}{\lambda^*}} =\lambda^* .
\]</span></p>
<p>因此EM算法收敛时的解就是MLE。</p>
<p>下证EM算法的收敛性。</p>
<p><br /></p>
<p>证明.</p>
<p>令迭代函数为</p>
<p><span class="math display">\[
f(\lambda) = \frac{1}{\frac{1}{n}\sum_{i=1}^{n}\frac{u_i e^{-\lambda
u_i}- v_i e^{-\lambda v_i}}{e^{-\lambda u_i}-e^{-\lambda v_i}} +
\frac{1}{\lambda}}.
\]</span></p>
<p>再令</p>
<p><span class="math display">\[
q(\lambda) = \sum_{i=1}^{n}\frac{u_i e^{-\lambda u_i}- v_i e^{-\lambda
v_i}}{e^{-\lambda u_i}-e^{-\lambda v_i}}, \\
q(\lambda^*) = 0.
\]</span></p>
<p><span class="math inline">\(\lambda^*\)</span>是<span class="math inline">\(f(\lambda)\)</span>的一个不动点。</p>
<p>下证<span class="math inline">\(0 &lt; f&#39;(\lambda^*) &lt;
1\)</span>。</p>
<p><span class="math display">\[
f&#39;(\lambda) =
-\frac{1}{(\frac{1}{n}q(\lambda)+\frac{1}{\lambda})^2}(\frac{1}{n}q&#39;(\lambda)-\frac{1}{\lambda^2}),
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
f&#39;(\lambda^*)  &amp;= 1-\frac{1}{n}\lambda^{*2}q&#39;(\lambda^*)\\
&amp;=1-
\frac{1}{n}\sum_{i=1}^n\frac{(u_i-v_i)^2\lambda^{*2}}{-2+e^{\lambda^*(v_i-u_i)}+e^{\lambda^*(u_i-v_i)}}.
\end{aligned}
\]</span></p>
<p>令<span class="math inline">\(d_i = (v_i - u_i)\lambda^* &gt;
0\)</span>,</p>
<p><span class="math display">\[
f&#39;(\lambda^*) = 1 - \frac{1}{n}\sum_{i =1}^n
frac{d_i^2}{(e^{frac{d_i}{2}}-e^{-frac{d_i}{2}})^2},
\]</span></p>
<p>泰勒展开</p>
<p><span class="math display">\[
\begin{aligned}
e^{frac{x}{2}}-e^{-frac{x}{2}} &amp;=
\sum_{n=0}^{\infty}\frac{x^n}{n!2^n}
-\sum_{n=0}^{\infty}(-1)^n\frac{x^n}{n!2^n} \\
&amp;= x + \sum_{n=1}^{\infty}\frac{x^(2n+1)}{(2n+1)!2^{2n}}\\
&amp;&gt; x,
\end{aligned}
\]</span></p>
<p>因此 <span class="math inline">\(0 &lt;
\frac{d_i^2}{(e^{frac{d_i}{2}}-e^{-frac{d_i}{2}})^2} &lt;
1\)</span>，带入f’(^*)可以简单验证得到，当EM算法收敛时，将MEL</p>
<p><span class="math display">\[
0 &lt; f&#39;(\lambda^*) &lt; 1,
\]</span></p>
<p>因此<span class="math inline">\(f(\lambda)\)</span>线性收敛于<span class="math inline">\(\lambda^*\)</span>。</p>
<p>（2）</p>
<p>先使用极大似然法</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">8</span>, <span class="dv">27</span>, <span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">2</span>)</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">28</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">1</span>, <span class="dv">24</span>, <span class="dv">11</span>, <span class="dv">25</span>, <span class="dv">3</span>)</span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>mlogL <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda) {</span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>    <span class="co"># minus log-likelihood</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">log</span>(<span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>u)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>v))))</span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>}</span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimize</span>(mlogL, <span class="at">lower=</span><span class="dv">0</span>, <span class="at">upper=</span><span class="dv">10</span>, <span class="at">maximum=</span><span class="cn">TRUE</span>)</span>
<span id="cb67-9"><a href="#cb67-9" tabindex="-1"></a>res<span class="sc">$</span>maximum</span></code></pre></div>
<pre><code>## [1] 0.07198597</code></pre>
<p>接下来使用EM算法</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">8</span>, <span class="dv">27</span>, <span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">2</span>)</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">28</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">1</span>, <span class="dv">24</span>, <span class="dv">11</span>, <span class="dv">25</span>, <span class="dv">3</span>)</span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a><span class="co"># EM算法的迭代函数</span></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda) {</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(((<span class="sc">-</span>v<span class="dv">-1</span><span class="sc">/</span>lambda)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>v)<span class="sc">+</span>(u<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span>lambda)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>u))<span class="sc">/</span>(<span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>u)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>v)))</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>}</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a>loss <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 前后两次迭代的差</span></span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 迭代次数</span></span>
<span id="cb69-11"><a href="#cb69-11" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb69-13"><a href="#cb69-13" tabindex="-1"></a><span class="cf">while</span> (t<span class="sc">&lt;</span><span class="dv">1000</span> <span class="sc">&amp;</span> loss<span class="sc">&gt;</span><span class="fl">1e-8</span>) { <span class="co"># 迭代次数大于1000或误差小于1e-8时停止迭代</span></span>
<span id="cb69-14"><a href="#cb69-14" tabindex="-1"></a>    lambda1 <span class="ot">&lt;-</span> lambda</span>
<span id="cb69-15"><a href="#cb69-15" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">f</span>(lambda)</span>
<span id="cb69-16"><a href="#cb69-16" tabindex="-1"></a>    loss <span class="ot">&lt;-</span> <span class="fu">abs</span>(lambda <span class="sc">-</span> lambda1)</span>
<span id="cb69-17"><a href="#cb69-17" tabindex="-1"></a>    t <span class="ot">=</span> t <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb69-18"><a href="#cb69-18" tabindex="-1"></a>}</span>
<span id="cb69-19"><a href="#cb69-19" tabindex="-1"></a>lambda</span></code></pre></div>
<pre><code>## [1] 0.0719735</code></pre>
<p>可以看到，两种方法得到的结果十分相近。</p>
</div>
<div id="section-32" class="section level3">
<h3>2</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>solve.game <span class="ot">&lt;-</span> <span class="cf">function</span>(A) {</span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a>    <span class="co">#solve the two player zero-sum game by simplex method</span></span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a>    <span class="co">#optimize for player 1, then player 2</span></span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>    <span class="co">#maximize v subject to ...</span></span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>    <span class="co">#let x strategies 1:m, and put v as extra variable</span></span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a>    <span class="co">#A1, the &lt;= constraints</span></span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a>    min.A <span class="ot">&lt;-</span> <span class="fu">min</span>(A)</span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a>    A <span class="ot">&lt;-</span> A <span class="sc">-</span> min.A <span class="co">#so that v &gt;= 0</span></span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>    max.A <span class="ot">&lt;-</span> <span class="fu">max</span>(A)</span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a>    A <span class="ot">&lt;-</span> A <span class="sc">/</span> <span class="fu">max</span>(A)</span>
<span id="cb71-12"><a href="#cb71-12" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">nrow</span>(A)</span>
<span id="cb71-13"><a href="#cb71-13" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(A)</span>
<span id="cb71-14"><a href="#cb71-14" tabindex="-1"></a>    it <span class="ot">&lt;-</span> n<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb71-15"><a href="#cb71-15" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, m), <span class="dv">1</span>) <span class="co">#objective function</span></span>
<span id="cb71-16"><a href="#cb71-16" tabindex="-1"></a>    A1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">cbind</span>(<span class="fu">t</span>(A), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, n)) <span class="co">#constraints &lt;=</span></span>
<span id="cb71-17"><a href="#cb71-17" tabindex="-1"></a>    b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb71-18"><a href="#cb71-18" tabindex="-1"></a>    A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, m), <span class="dv">0</span>))) <span class="co">#constraints sum(x)=1</span></span>
<span id="cb71-19"><a href="#cb71-19" tabindex="-1"></a>    b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-20"><a href="#cb71-20" tabindex="-1"></a>    sx <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb71-21"><a href="#cb71-21" tabindex="-1"></a>        <span class="at">maxi=</span><span class="cn">TRUE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb71-22"><a href="#cb71-22" tabindex="-1"></a>    <span class="co">#the ’solution’ is [x1,x2,...,xm | value of game]</span></span>
<span id="cb71-23"><a href="#cb71-23" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb71-24"><a href="#cb71-24" tabindex="-1"></a>    <span class="co">#minimize v subject to ...</span></span>
<span id="cb71-25"><a href="#cb71-25" tabindex="-1"></a>    <span class="co">#let y strategies 1:n, with v as extra variable</span></span>
<span id="cb71-26"><a href="#cb71-26" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, n), <span class="dv">1</span>) <span class="co">#objective function</span></span>
<span id="cb71-27"><a href="#cb71-27" tabindex="-1"></a>    A1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, m)) <span class="co">#constraints &lt;=</span></span>
<span id="cb71-28"><a href="#cb71-28" tabindex="-1"></a>    b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb71-29"><a href="#cb71-29" tabindex="-1"></a>    A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), <span class="dv">0</span>))) <span class="co">#constraints sum(y)=1</span></span>
<span id="cb71-30"><a href="#cb71-30" tabindex="-1"></a>    b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-31"><a href="#cb71-31" tabindex="-1"></a>    sy <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb71-32"><a href="#cb71-32" tabindex="-1"></a>        <span class="at">maxi=</span><span class="cn">FALSE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb71-33"><a href="#cb71-33" tabindex="-1"></a>    soln <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> A <span class="sc">*</span> max.A <span class="sc">+</span> min.A,</span>
<span id="cb71-34"><a href="#cb71-34" tabindex="-1"></a>        <span class="st">&quot;x&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>m],</span>
<span id="cb71-35"><a href="#cb71-35" tabindex="-1"></a>        <span class="st">&quot;y&quot;</span> <span class="ot">=</span> sy<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>n],</span>
<span id="cb71-36"><a href="#cb71-36" tabindex="-1"></a>        <span class="st">&quot;v&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[m<span class="sc">+</span><span class="dv">1</span>] <span class="sc">*</span> max.A <span class="sc">+</span> min.A)</span>
<span id="cb71-37"><a href="#cb71-37" tabindex="-1"></a>    soln</span>
<span id="cb71-38"><a href="#cb71-38" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="co">#enter the payoff matrix</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(  <span class="dv">0</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>                <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>                <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>                <span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>                <span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>                <span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>                <span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>                <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>                <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="dv">0</span>), <span class="dv">9</span>, <span class="dv">9</span>)</span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a><span class="fu">library</span>(boot) <span class="co">#needed for simplex function</span></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">solve.game</span>(A)</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(s<span class="sc">$</span>x, s<span class="sc">$</span>y), <span class="dv">7</span>)</span></code></pre></div>
<pre><code>##         [,1]      [,2]
## x1 0.0000000 0.0000000
## x2 0.0000000 0.0000000
## x3 0.4098361 0.4098361
## x4 0.0000000 0.0000000
## x5 0.3278689 0.3278689
## x6 0.0000000 0.0000000
## x7 0.2622951 0.2622951
## x8 0.0000000 0.0000000
## x9 0.0000000 0.0000000</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>B <span class="ot">&lt;-</span> A <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">solve.game</span>(B)</span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(s1<span class="sc">$</span>x, s1<span class="sc">$</span>y), <span class="dv">7</span>)</span></code></pre></div>
<pre><code>##         [,1]      [,2]
## x1 0.0000000 0.0000000
## x2 0.0000000 0.0000000
## x3 0.4098361 0.4098361
## x4 0.0000000 0.0000000
## x5 0.3278689 0.3278689
## x6 0.0000000 0.0000000
## x7 0.2622951 0.2622951
## x8 0.0000000 0.0000000
## x9 0.0000000 0.0000000</code></pre>
<p>可以看到，游戏A和游戏B得到的最有策略是一样的，都是（11.12）<span class="math inline">\((0, 0, 5/12, 0, 4/12, 0, 3/12, 0,
0)\)</span>。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;A: &quot;</span>, s<span class="sc">$</span>v)</span></code></pre></div>
<pre><code>## A:  0</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;B: &quot;</span>, s1<span class="sc">$</span>v)</span></code></pre></div>
<pre><code>## B:  2</code></pre>
<p>游戏A的价值是0，游戏2的价值是2。</p>
</div>
</div>
</div>
<div id="section-33" class="section level1">
<h1>2023/11/20</h1>
<div id="question-9" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<ul>
<li>2.1.3 Exercise 4 (Pages 19 Advanced in R)</li>
<li>2.3.1 Exercise 1, 2 (Pages 26 Advanced in R)</li>
<li>2.4.5 Exercise 2, 3 (Pages 30 Advanced in R)</li>
<li>Exercises 2 (page 204, Advanced R)</li>
<li>Exercises 1 (page 213, Advanced R)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Consider Exercise 9.8 (pages 278, Statistical Computing with R).
(Hint: Refer to the first example of Case studies section)</li>
</ol>
<ul>
<li>Write an R function.</li>
<li>Write an Rcpp function.</li>
<li>Compare the computation time of the two functions with the function
“microbenchmark”</li>
</ul>
</div>
<div id="answer-9" class="section level2">
<h2>Answer</h2>
<div id="exercise-4" class="section level3">
<h3>2.1.3 Exercise 4</h3>
<p><code>unlist()</code>可以将列表展平成为向量；<code>as.vector()</code>不会将列表展平，当列表有嵌套结构时，<code>as.vector()</code>可能无法产生期望的结果。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="fu">list</span>(<span class="at">c =</span> <span class="dv">2</span>, <span class="at">d =</span> <span class="dv">3</span>))</span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a><span class="fu">unlist</span>(x)</span></code></pre></div>
<pre><code>##   a b.c b.d 
##   1   2   3</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">as.vector</span>(x)</span></code></pre></div>
<pre><code>## $a
## [1] 1
## 
## $b
## $b$c
## [1] 2
## 
## $b$d
## [1] 3</code></pre>
</div>
<div id="exercise-1" class="section level3">
<h3>2.3.1 Exercise 1</h3>
<p>将会返回NULL，向量没有维度概念。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a><span class="fu">dim</span>(a)</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="exercise-2" class="section level3">
<h3>2.3.1 Exercise 2</h3>
<p><code>is.array(x)</code>的结果也是TRUE，因为matrix是始终特殊的array。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a><span class="fu">is.matrix</span>(x)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="fu">is.array</span>(x)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="exercise-2-1" class="section level3">
<h3>2.4.5 Exercise 2</h3>
<p><code>as.matrix()</code>会将所有数据转换为同一类型，转换结果遵循R中的规则。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a>    <span class="at">numeric_col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>    <span class="at">character_col =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>    <span class="at">logical_col =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb91-5"><a href="#cb91-5" tabindex="-1"></a>)</span>
<span id="cb91-6"><a href="#cb91-6" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" tabindex="-1"></a><span class="fu">as.matrix</span>(x)</span></code></pre></div>
<pre><code>##      numeric_col character_col logical_col
## [1,] &quot;1&quot;         &quot;a&quot;           &quot;TRUE&quot;     
## [2,] &quot;2&quot;         &quot;b&quot;           &quot;FALSE&quot;    
## [3,] &quot;3&quot;         &quot;c&quot;           &quot;TRUE&quot;</code></pre>
</div>
<div id="exercise-3" class="section level3">
<h3>2.4.5 Exercise 3</h3>
<p>0行的dataframe可以实现。</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">3</span>))</span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a>x1</span></code></pre></div>
<pre><code>## [1] X1 X2 X3
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>0列的dataframe也可以实现。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">0</span>))</span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>x2</span></code></pre></div>
<pre><code>## data frame with 0 columns and 3 rows</code></pre>
</div>
<div id="exercises-2204" class="section level3">
<h3>Exercises 2（204）</h3>
<p>运用到所有列。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a>scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a>    (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a>}</span>
<span id="cb97-5"><a href="#cb97-5" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb97-7"><a href="#cb97-7" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb97-8"><a href="#cb97-8" tabindex="-1"></a>    <span class="at">b =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb97-9"><a href="#cb97-9" tabindex="-1"></a>    <span class="at">c =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb97-10"><a href="#cb97-10" tabindex="-1"></a>)</span>
<span id="cb97-11"><a href="#cb97-11" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" tabindex="-1"></a><span class="fu">lapply</span>(x, scale01)</span></code></pre></div>
<pre><code>## $a
## [1] 0.0 0.5 1.0
## 
## $b
## [1] 0.0 0.5 1.0
## 
## $c
## [1] 0.0 0.5 1.0</code></pre>
<p>运用到数值列。</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>    <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&#39;q&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;e&#39;</span>),</span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a>    <span class="at">c =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a>)</span>
<span id="cb99-6"><a href="#cb99-6" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" tabindex="-1"></a><span class="fu">lapply</span>(y, <span class="cf">function</span>(x) {<span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">scale01</span>(x) <span class="cf">else</span> x})</span></code></pre></div>
<pre><code>## $a
## [1] 0.0 0.5 1.0
## 
## $b
## [1] &quot;q&quot; &quot;w&quot; &quot;e&quot;
## 
## $c
## [1] 0.0 0.5 1.0</code></pre>
</div>
<div id="exercises-1213" class="section level3">
<h3>Exercises 1（213）</h3>
<p>运用到所有列。</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a>    <span class="at">b =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb101-4"><a href="#cb101-4" tabindex="-1"></a>    <span class="at">c =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb101-5"><a href="#cb101-5" tabindex="-1"></a>)</span>
<span id="cb101-6"><a href="#cb101-6" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" tabindex="-1"></a><span class="fu">vapply</span>(x, sd, <span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## a b c 
## 1 1 1</code></pre>
<p>运用到数值列。</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>    <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&#39;q&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;e&#39;</span>),</span>
<span id="cb103-4"><a href="#cb103-4" tabindex="-1"></a>    <span class="at">c =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb103-5"><a href="#cb103-5" tabindex="-1"></a>)</span>
<span id="cb103-6"><a href="#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" tabindex="-1"></a><span class="fu">vapply</span>(y[<span class="fu">vapply</span>(y, is.numeric, <span class="fu">logical</span>(<span class="dv">1</span>))], sd, <span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## a c 
## 1 1</code></pre>
</div>
<div id="exercise-9.8" class="section level3">
<h3>Exercise 9.8</h3>
<p>R function</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="co">#initialize constants and parameters</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50000</span> <span class="co">#length of chain</span></span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb105-6"><a href="#cb105-6" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb105-7"><a href="#cb105-7" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb105-8"><a href="#cb105-8" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" tabindex="-1"></a>gibbsR <span class="ot">&lt;-</span> <span class="cf">function</span>(N, burn, n, a, b){</span>
<span id="cb105-10"><a href="#cb105-10" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb105-11"><a href="#cb105-11" tabindex="-1"></a>    y1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb105-12"><a href="#cb105-12" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>) <span class="co">#the chain, a bivariate sample</span></span>
<span id="cb105-13"><a href="#cb105-13" tabindex="-1"></a>    X[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(x1, y1)</span>
<span id="cb105-14"><a href="#cb105-14" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb105-16"><a href="#cb105-16" tabindex="-1"></a>        yt <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb105-17"><a href="#cb105-17" tabindex="-1"></a>        X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, yt)</span>
<span id="cb105-18"><a href="#cb105-18" tabindex="-1"></a>        xt <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb105-19"><a href="#cb105-19" tabindex="-1"></a>        X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, xt <span class="sc">+</span> a, n <span class="sc">-</span> xt <span class="sc">+</span> b)</span>
<span id="cb105-20"><a href="#cb105-20" tabindex="-1"></a>    }</span>
<span id="cb105-21"><a href="#cb105-21" tabindex="-1"></a>    X</span>
<span id="cb105-22"><a href="#cb105-22" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" tabindex="-1"></a><span class="co"># dir_cpp &lt;- &quot;./&quot;</span></span>
<span id="cb106-5"><a href="#cb106-5" tabindex="-1"></a><span class="co"># sourceCpp(paste0(dir_cpp, &quot;gibbsC.cpp&quot;))</span></span>
<span id="cb106-6"><a href="#cb106-6" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;NumericMatrix gibbsC(int N, int burn, int n, int a, int b) {</span></span>
<span id="cb106-8"><a href="#cb106-8" tabindex="-1"></a><span class="st">    int x1 = 3;</span></span>
<span id="cb106-9"><a href="#cb106-9" tabindex="-1"></a><span class="st">    double y1 = 0.5;</span></span>
<span id="cb106-10"><a href="#cb106-10" tabindex="-1"></a><span class="st">    NumericMatrix X(N, 2);</span></span>
<span id="cb106-11"><a href="#cb106-11" tabindex="-1"></a><span class="st">    X(0, 0) = x1;</span></span>
<span id="cb106-12"><a href="#cb106-12" tabindex="-1"></a><span class="st">    X(0, 1) = y1;</span></span>
<span id="cb106-13"><a href="#cb106-13" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" tabindex="-1"></a><span class="st">    int xt = x1;</span></span>
<span id="cb106-15"><a href="#cb106-15" tabindex="-1"></a><span class="st">    double yt = y1;</span></span>
<span id="cb106-16"><a href="#cb106-16" tabindex="-1"></a><span class="st">    for (int i = 1; i &lt; N; i++) {</span></span>
<span id="cb106-17"><a href="#cb106-17" tabindex="-1"></a><span class="st">        yt = X(i-1, 1);</span></span>
<span id="cb106-18"><a href="#cb106-18" tabindex="-1"></a><span class="st">        X(i, 0) = R::rbinom(n, yt);</span></span>
<span id="cb106-19"><a href="#cb106-19" tabindex="-1"></a><span class="st">        xt = X(i, 0);</span></span>
<span id="cb106-20"><a href="#cb106-20" tabindex="-1"></a><span class="st">        X(i, 1) = R::rbeta(xt + a, n - xt + b);</span></span>
<span id="cb106-21"><a href="#cb106-21" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb106-22"><a href="#cb106-22" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" tabindex="-1"></a><span class="st">    return X;</span></span>
<span id="cb106-24"><a href="#cb106-24" tabindex="-1"></a><span class="st">}&#39;</span>)</span>
<span id="cb106-25"><a href="#cb106-25" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="at">gibbsR=</span><span class="fu">gibbsR</span>(N, burn, n, a, b), <span class="at">gibbsC=</span><span class="fu">gibbsC</span>(N, burn, n, a, b))</span>
<span id="cb106-27"><a href="#cb106-27" tabindex="-1"></a><span class="fu">summary</span>(ts)[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span></code></pre></div>
<pre><code>##     expr       lq   median       uq
## 1 gibbsR 102.6770 103.5105 104.8831
## 2 gibbsC   7.9453   7.9940   8.0931</code></pre>
<p>可以看到使用Rcpp的运行时间比直接使用R function的时间短很多。</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
